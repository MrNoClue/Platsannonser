---
title: "Platsannonser (hos Af) - Jämtland"
author: "Detta är ett PM från Analyssamverkan Norr."
date: "`r format(Sys.Date(), '%Y-%m-%d')`"
output: 
  html_document:
    css: styles_AN.css  
    toc: yes
    toc_float:
      toc_collapsed: true
    toc_depth: 3
    number_sections: true
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```


:::{#preface}
<p>
Detta PM visar annonsdata från Arbetsförmedlingens JobTech API, till och med 2025-06-04 - syftet är att ge en nulägesbild av eftersökt kompetens (yrken).

Lediga tjänster redovisas utifrån två olika ingångar: område och nivå. I "Yrkesområde (Af)" redovisas lediga tjänster utifrån område, därefter redovisas, per område, vilka yrken (SSYK3) som eftersöks. I "Nivå (SSYK1)" redovisas istället lediga tjänster utifrån den första nivån i SSYK-indelningen - den signalerar vilken utbildningsnivå yrkena kräver. Per nivå redovisas sedan inom vilka områden som eftersökta yrken finns.
</p>
:::

# Sammanfattning {-}

```{r load_df, message=FALSE, warning=FALSE, fig.align = "center"}

library(tidyverse)
library(ggthemes)
library(rio)
library(scales)


# Load raw-data-file
## Get the current working directory (R root directory)
root_dir <- getwd()

## Specify the relative file path from the R root directory
relative_path <- "platsannons_wtext.xlsx"

## Construct the full file path
file_path <- file.path(root_dir, relative_path)

## Import the file using the full file path
df <- import(file_path)


# TO-BE MODIFIED
geografi<-"Jämtland"

df <- filter(df, substr(workplace_address.municipality_code,1,2) == 23)

# GET VALUES
## TOTAL
summa <- sum(df$number_of_vacancies, na.rm = T)
summa <- format(summa, big.mark=" ")

## 2284
df_temp <- filter(df, substr(workplace_address.municipality_code,1,4) == 2303)
ragunda <- sum(df_temp$number_of_vacancies, na.rm = T)
ragunda <- format(ragunda, big.mark=" ")

## 2283
df_temp <- filter(df, substr(workplace_address.municipality_code,1,4) == 2305)
bracke <- sum(df_temp$number_of_vacancies, na.rm = T)
bracke <- format(bracke, big.mark=" ")

## 2282
df_temp <- filter(df, substr(workplace_address.municipality_code,1,4) == 2309)
krokom <- sum(df_temp$number_of_vacancies, na.rm = T)
krokom <- format(krokom, big.mark=" ")

## 2280
df_temp <- filter(df, substr(workplace_address.municipality_code,1,4) == 2313)
stromsund <- sum(df_temp$number_of_vacancies, na.rm = T)
stromsund <- format(stromsund, big.mark=" ")

## 2281
df_temp <- filter(df, substr(workplace_address.municipality_code,1,4) == 2321)
are <- sum(df_temp$number_of_vacancies, na.rm = T)
are <- format(are, big.mark=" ")

## 2260
df_temp <- filter(df, substr(workplace_address.municipality_code,1,4) == 2326)
berg <- sum(df_temp$number_of_vacancies, na.rm = T)
berg <- format(berg, big.mark=" ")

## 2281
df_temp <- filter(df, substr(workplace_address.municipality_code,1,4) == 2361)
harjedalen <- sum(df_temp$number_of_vacancies, na.rm = T)
harjedalen <- format(harjedalen, big.mark=" ")

## 2260
df_temp <- filter(df, substr(workplace_address.municipality_code,1,4) == 2380)
ostersund <- sum(df_temp$number_of_vacancies, na.rm = T)
ostersund <- format(ostersund, big.mark=" ")

```

* `r summa` lediga tjänster i `r geografi` hos Platsbanken, varav:
  + `r ragunda` i Ragunda kommun
  + `r bracke` i Bräcke kommun
  + `r krokom` i Krokom kommun
  + `r stromsund` i Strömsund kommun
  + `r are` i Åre kommun
  + `r berg` i Berg kommun
  + `r harjedalen` i Härjedalen kommun
  + `r ostersund` i Östersund kommun

<br>

# Om
På flera ställen redovisas statistik utifrån *standard för svensk yrkesklassificering* (SSYK), läs mer hos SCB: [Standard för svensk yrkesklassificering (SSYK)](https://www.scb.se/dokumentation/klassifikationer-och-standarder/standard-for-svensk-yrkesklassificering-ssyk/).

Kodning sker enligt formatet: SSYK1 - innebär att statistik redovisas utifrån översta nivån (1). SSYK1-2 - innebär att statistik redovisas utifrån översta nivån och inriktning 2. På samma sätt innebär SSYK2-3 att statistik redovisas utifrån andra nivån och inriktning 3.

<br>

## Yrkesområde (Af)

Först visas 3 diagram med tjänster per yrkesområde. Det första färglägger tjänster utifrån typ av anställning, den andra färglägger tjänster utifrån kvalifikationsnivå och det sista utifrån vilken kommun tjänsten är utlyst i.

Kvalifikationsnivån har kodats utifrån SSYK1-nivån:

* 1 - Inga eller låga formella utbildningskrav
  + SSYK 9
* 2 - Gymnasie eller eftergymnasial utbildning kortare än 2 år
  + SSYK 03
  + SSYK 4
  + SSYK 5
  + SSYK 6
  + SSYK 7
  + SSYK 8
* 3 - Praktiska eller yrkesspecifika eftergymnasiala utbildningar på 2-3 år
  + SSYK 02
  + SSYK 17
  + SSYK 3
* 4 - Teoretiska eftergymnasiala utbildningar om minst 3 år
  + SSYK 01
  + SSYK 1
  + SSYK 2

Därefter redovisas tjänster utifrån SSYK3-nivå **per område**. Områdena listas i alfabetisk ordning. 

Per område redovisas två diagram. Det första diagrammet färgläggs efter kvalifikationsnivån, det andra färgsläggs efter vilken kommun som tjänsten är utlyst i.

<br>

## Nivå (SSYK1)

Här visas eftersökta tjänster efter högsta nivån i SSYK-indelningen - den signalerar vilken utbildningsnivå yrkena kräver. Det finns 10 olika inriktningar på ensiffernivå.

Per nivå redovisas sedan inom vilka områden, enligt Af:s indelning, som eftersökta yrken finns. En tabell visar också eftersökta yrken (SSYK3) - där behovs- och ferieanställningar är särredovisade. Underubrikerna följer SSYK1-ordningen, utom för "Militära yrken" - som egentligen är 0, men här hamnar under 3.10.

Samtliga diagram under denna sektion är färglagda enligt var tjänsterna är utlysta.

<br>

# Yrkesområde (Af)

```{r platser_typ_22, message=FALSE, warning=FALSE, fig.align = "center"}

## Filter on 22
df_22_sommar <- df


## Group and summarize
df_22_sommar <- df_22_sommar %>%
  group_by(occupation_field.label,employment_type.label) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

df_22_sommar$total_vac <- as.numeric(df_22_sommar$total_vac)

max_value <- df_22_sommar %>%
  group_by(occupation_field.label) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)

## Korta ner namn på fill-serie
df_22_sommar$employment_type.label[df_22_sommar$employment_type.label == "Behovsanställning"] <- "Behov"
df_22_sommar$employment_type.label[df_22_sommar$employment_type.label == "Sommarjobb / feriejobb"] <- "Ferie"
df_22_sommar$employment_type.label[df_22_sommar$employment_type.label == "Vanlig anställning"] <- "Vanlig"

df_22_sommar <- df_22_sommar %>%
  mutate(occupation_field.label = forcats::fct_reorder(occupation_field.label, total_vac, .fun = sum))

ggplot(df_22_sommar, aes(x = occupation_field.label, 
                         y = total_vac, fill = employment_type.label)) +
  geom_col()+
  scale_fill_manual(values = c("#005ca9", "#95c11f", "#cbcbcb"))+
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte()+
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title=element_blank(), #droppar legend title
        legend.position = "top",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle=sprintf("Område & typ av anställning - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland")+
  coord_flip()
```
*För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

```{r platser_kvalniva_22, message=FALSE, warning=FALSE, fig.align = "center"}
library(viridis)

## Filter on 22
df_22_kval <- df

df_22_kval <- df_22_kval %>%
  group_by(occupation_field.label, kvalifikations_niva) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_kval %>%
  group_by(occupation_field.label) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_kval$total_vac <- as.numeric(df_22_kval$total_vac)

df_22_kval <- df_22_kval %>%
  mutate(occupation_field.label = forcats::fct_reorder(occupation_field.label, total_vac, .fun = sum),
         kvalifikations_niva = factor(kvalifikations_niva, levels = c("1", "2", "3", "4")))


ggplot(df_22_kval, aes(x = occupation_field.label, y = total_vac, fill = factor(kvalifikations_niva, levels = c("4", "3", "2", "1")))) +
  geom_col() +
  scale_fill_viridis(discrete = TRUE, direction = 1, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Område & kvalifikationsnivå (kodat efter SSYK1) - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  coord_flip()
```
*1 - Inga eller låga formella utbildningskrav, 2 - Gymnasie eller eftergymnasial utbildning kortare än 2 år, 3 - Praktiska eller yrkesspecifika eftergymnasiala utbildningar på 2-3 år, 4 - Teoretiska eftergymnasiala utbildningar om minst 3 år. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

```{r platser_omraden_kommun, message=FALSE, warning=FALSE, fig.align = "center"}
library(RColorBrewer)

df_22_kom <- df

df_22_kom <- df_22_kom %>%
  group_by(occupation_field.label, workplace_address.municipality_code) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_kom %>%
  group_by(occupation_field.label) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_kom$total_vac <- as.numeric(df_22_kom$total_vac)

df_22_kom <- df_22_kom %>%
  mutate(occupation_field.label = forcats::fct_reorder(occupation_field.label, total_vac, .fun = sum),
         workplace_address.municipality_code = factor(workplace_address.municipality_code, 
                                                      levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))

color_mapping <- c("2313" = "#FF7F00", "2309" = "#FDBF6F", "2321" = "#E31A1C", "2380" = "#FB9A99", 
                   "2303" = "#33A02C", "2305" = "#B2DF8A", "2326" = "#1F78B4", "2361" = "#A6CEE3")

# VIZ
## ggplot
ggplot(df_22_kom, aes(x = occupation_field.label, y = total_vac, fill = factor(workplace_address.municipality_code, levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  #scale_fill_viridis(discrete = T) +
  #scale_fill_brewer(palette = "Paired")+
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Område & plats i geografin - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  coord_flip()

```
*Kommunkod: 2313 - Strömsund, 2309 - Krokom, 2321 - Åre, 2380 - Östersund, 2303 - Ragunda, 2305 - Bräcke, 2326 - Berg, 2361 - Härjedalen. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

## Admin., ekonomi, juridik

```{r omradeAEJ_SSYK_kval_22, message=FALSE, warning=FALSE, fig.align = "center"}
## Filter
df_22_omrade_kval <- filter(df, occupation_field.label == "Administration, ekonomi, juridik")

df_22_omrade_kval <- df_22_omrade_kval %>%
  group_by(ssyk3_text, ssyk3_code, kvalifikations_niva) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_omrade_kval %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade_kval$total_vac <- as.numeric(df_22_omrade_kval$total_vac)

df_22_omrade_kval <- df_22_omrade_kval %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         kvalifikations_niva = factor(kvalifikations_niva, levels = c("1", "2", "3", "4")))


color_mapping <- c("1" = "#FDE725", "2" = "#35B779", "3" = "#31688E", "4" = "#440154")


ggplot(df_22_omrade_kval, aes(x = ssyk3_text, y = total_vac, fill = factor(kvalifikations_niva, levels = c("4", "3", "2", "1")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Admin., ekonomi, juridik, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()
```
*1 - Inga eller låga formella utbildningskrav, 2 - Gymnasie eller eftergymnasial utbildning kortare än 2 år, 3 - Praktiska eller yrkesspecifika eftergymnasiala utbildningar på 2-3 år, 4 - Teoretiska eftergymnasiala utbildningar om minst 3 år. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

```{r omradeAEJ_SSYK_kommun_22, message=FALSE, warning=FALSE, fig.align = "center"}
library(scales)

## Filter on 22
df_22_omrade <- filter(df, occupation_field.label == "Administration, ekonomi, juridik")

df_22_omrade <- df_22_omrade %>%
  group_by(ssyk3_text, workplace_address.municipality_code) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_omrade %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade$total_vac <- as.numeric(df_22_omrade$total_vac)

df_22_omrade <- df_22_omrade %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         workplace_address.municipality_code = factor(workplace_address.municipality_code, 
                                                      levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))

color_mapping <- c("2313" = "#FF7F00", "2309" = "#FDBF6F", "2321" = "#E31A1C", "2380" = "#FB9A99", 
                            "2303" = "#33A02C", "2305" = "#B2DF8A", "2326" = "#1F78B4", "2361" = "#A6CEE3")

ggplot(df_22_omrade, aes(x = ssyk3_text, y = total_vac, fill = factor(workplace_address.municipality_code, levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  #scale_fill_viridis(discrete = TRUE, direction = 1, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Admin., ekonomi, juridik, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()


```
*Kommunkod: 2313 - Strömsund, 2309 - Krokom, 2321 - Åre, 2380 - Östersund, 2303 - Ragunda, 2305 - Bräcke, 2326 - Berg, 2361 - Härjedalen. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

## Bygg och anläggning

```{r omradeBA_SSYK_kval_22, message=FALSE, warning=FALSE, fig.align = "center"}
## Filter
df_22_omrade_kval <- filter(df, occupation_field.label == "Bygg och anläggning")

df_22_omrade_kval <- df_22_omrade_kval %>%
  group_by(ssyk3_text, ssyk3_code, kvalifikations_niva) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_omrade_kval %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade_kval$total_vac <- as.numeric(df_22_omrade_kval$total_vac)

df_22_omrade_kval <- df_22_omrade_kval %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         kvalifikations_niva = factor(kvalifikations_niva, levels = c("1", "2", "3", "4")))


color_mapping <- c("1" = "#FDE725", "2" = "#35B779", "3" = "#31688E", "4" = "#440154")


ggplot(df_22_omrade_kval, aes(x = ssyk3_text, y = total_vac, fill = factor(kvalifikations_niva, levels = c("4", "3", "2", "1")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Bygg och anläggning, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()
```
*1 - Inga eller låga formella utbildningskrav, 2 - Gymnasie eller eftergymnasial utbildning kortare än 2 år, 3 - Praktiska eller yrkesspecifika eftergymnasiala utbildningar på 2-3 år, 4 - Teoretiska eftergymnasiala utbildningar om minst 3 år. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

```{r omradeBA_SSYK_kommun_22, message=FALSE, warning=FALSE, fig.align = "center"}

## Filter on 22
df_22_omrade <- filter(df, occupation_field.label == "Bygg och anläggning")

df_22_omrade <- df_22_omrade %>%
  group_by(ssyk3_text, workplace_address.municipality_code) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_omrade %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade$total_vac <- as.numeric(df_22_omrade$total_vac)

df_22_omrade <- df_22_omrade %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         workplace_address.municipality_code = factor(workplace_address.municipality_code, 
                                                      levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))

color_mapping <- c("2313" = "#FF7F00", "2309" = "#FDBF6F", "2321" = "#E31A1C", "2380" = "#FB9A99", 
                            "2303" = "#33A02C", "2305" = "#B2DF8A", "2326" = "#1F78B4", "2361" = "#A6CEE3")

ggplot(df_22_omrade, aes(x = ssyk3_text, y = total_vac, fill = factor(workplace_address.municipality_code, levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  #scale_fill_viridis(discrete = TRUE, direction = 1, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Bygg och anläggning, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()


```
*Kommunkod: 2313 - Strömsund, 2309 - Krokom, 2321 - Åre, 2380 - Östersund, 2303 - Ragunda, 2305 - Bräcke, 2326 - Berg, 2361 - Härjedalen. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

## Chefer och verk.ledare

```{r omradeCV_SSYK_kval_22, message=FALSE, warning=FALSE, fig.align = "center"}
## Filter
df_22_omrade_kval <- filter(df, occupation_field.label == "Chefer och verksamhetsledare")

df_22_omrade_kval <- df_22_omrade_kval %>%
  group_by(ssyk3_text, ssyk3_code, kvalifikations_niva) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_omrade_kval %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade_kval$total_vac <- as.numeric(df_22_omrade_kval$total_vac)

df_22_omrade_kval <- df_22_omrade_kval %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         kvalifikations_niva = factor(kvalifikations_niva, levels = c("1", "2", "3", "4")))


color_mapping <- c("1" = "#FDE725", "2" = "#35B779", "3" = "#31688E", "4" = "#440154")


ggplot(df_22_omrade_kval, aes(x = ssyk3_text, y = total_vac, fill = factor(kvalifikations_niva, levels = c("4", "3", "2", "1")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Chefer och verksamhetsledare, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()
```
*1 - Inga eller låga formella utbildningskrav, 2 - Gymnasie eller eftergymnasial utbildning kortare än 2 år, 3 - Praktiska eller yrkesspecifika eftergymnasiala utbildningar på 2-3 år, 4 - Teoretiska eftergymnasiala utbildningar om minst 3 år. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

```{r omradeCV_SSYK_kommun_22, message=FALSE, warning=FALSE, fig.align = "center"}

## Filter on 22
df_22_omrade <- filter(df, occupation_field.label == "Chefer och verksamhetsledare")

df_22_omrade <- df_22_omrade %>%
  group_by(ssyk3_text, workplace_address.municipality_code) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_omrade %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade$total_vac <- as.numeric(df_22_omrade$total_vac)

df_22_omrade <- df_22_omrade %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         workplace_address.municipality_code = factor(workplace_address.municipality_code, 
                                                      levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))

color_mapping <- c("2313" = "#FF7F00", "2309" = "#FDBF6F", "2321" = "#E31A1C", "2380" = "#FB9A99", 
                            "2303" = "#33A02C", "2305" = "#B2DF8A", "2326" = "#1F78B4", "2361" = "#A6CEE3")

ggplot(df_22_omrade, aes(x = ssyk3_text, y = total_vac, fill = factor(workplace_address.municipality_code, levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  #scale_fill_viridis(discrete = TRUE, direction = 1, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Chefer och verksamhetsledare, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()


```
*Kommunkod: 2313 - Strömsund, 2309 - Krokom, 2321 - Åre, 2380 - Östersund, 2303 - Ragunda, 2305 - Bräcke, 2326 - Berg, 2361 - Härjedalen. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

## Data/IT

```{r omradeIT_SSYK_kval_22, message=FALSE, warning=FALSE, fig.align = "center"}
## Filter
df_22_omrade_kval <- filter(df, occupation_field.label == "Data/IT")

df_22_omrade_kval <- df_22_omrade_kval %>%
  group_by(ssyk3_text, ssyk3_code, kvalifikations_niva) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_omrade_kval %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade_kval$total_vac <- as.numeric(df_22_omrade_kval$total_vac)

df_22_omrade_kval <- df_22_omrade_kval %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         kvalifikations_niva = factor(kvalifikations_niva, levels = c("1", "2", "3", "4")))


color_mapping <- c("1" = "#FDE725", "2" = "#35B779", "3" = "#31688E", "4" = "#440154")


ggplot(df_22_omrade_kval, aes(x = ssyk3_text, y = total_vac, fill = factor(kvalifikations_niva, levels = c("4", "3", "2", "1")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Data/IT, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()
```
*1 - Inga eller låga formella utbildningskrav, 2 - Gymnasie eller eftergymnasial utbildning kortare än 2 år, 3 - Praktiska eller yrkesspecifika eftergymnasiala utbildningar på 2-3 år, 4 - Teoretiska eftergymnasiala utbildningar om minst 3 år. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

```{r omradeIT_SSYK_kommun_22, message=FALSE, warning=FALSE, fig.align = "center"}

## Filter on 22
df_22_omrade <- filter(df, occupation_field.label == "Data/IT")

df_22_omrade <- df_22_omrade %>%
  group_by(ssyk3_text, workplace_address.municipality_code) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_omrade %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade$total_vac <- as.numeric(df_22_omrade$total_vac)

df_22_omrade <- df_22_omrade %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         workplace_address.municipality_code = factor(workplace_address.municipality_code, 
                                                      levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))

color_mapping <- c("2313" = "#FF7F00", "2309" = "#FDBF6F", "2321" = "#E31A1C", "2380" = "#FB9A99", 
                            "2303" = "#33A02C", "2305" = "#B2DF8A", "2326" = "#1F78B4", "2361" = "#A6CEE3")

ggplot(df_22_omrade, aes(x = ssyk3_text, y = total_vac, fill = factor(workplace_address.municipality_code, levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  #scale_fill_viridis(discrete = TRUE, direction = 1, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Data/IT, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()


```
*Kommunkod: 2313 - Strömsund, 2309 - Krokom, 2321 - Åre, 2380 - Östersund, 2303 - Ragunda, 2305 - Bräcke, 2326 - Berg, 2361 - Härjedalen. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

## Frsj., inköp, marknadsföring

```{r omradeFIM_SSYK_kval_22, message=FALSE, warning=FALSE, fig.align = "center"}
## Filter 
df_22_omrade_kval <- filter(df, occupation_field.label == "Försäljning, inköp, marknadsföring")

df_22_omrade_kval <- df_22_omrade_kval %>%
  group_by(ssyk3_text, ssyk3_code, kvalifikations_niva) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_omrade_kval %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade_kval$total_vac <- as.numeric(df_22_omrade_kval$total_vac)

df_22_omrade_kval <- df_22_omrade_kval %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         kvalifikations_niva = factor(kvalifikations_niva, levels = c("1", "2", "3", "4")))


color_mapping <- c("1" = "#FDE725", "2" = "#35B779", "3" = "#31688E", "4" = "#440154")


ggplot(df_22_omrade_kval, aes(x = ssyk3_text, y = total_vac, fill = factor(kvalifikations_niva, levels = c("4", "3", "2", "1")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Frsj., inköp, marknadsföring, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()
```
*1 - Inga eller låga formella utbildningskrav, 2 - Gymnasie eller eftergymnasial utbildning kortare än 2 år, 3 - Praktiska eller yrkesspecifika eftergymnasiala utbildningar på 2-3 år, 4 - Teoretiska eftergymnasiala utbildningar om minst 3 år. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

```{r omradeFIM_SSYK_kommun_22, message=FALSE, warning=FALSE, fig.align = "center"}

## Filter on 22
df_22_omrade <- filter(df, occupation_field.label == "Försäljning, inköp, marknadsföring")

df_22_omrade <- df_22_omrade %>%
  group_by(ssyk3_text, workplace_address.municipality_code) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_omrade %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade$total_vac <- as.numeric(df_22_omrade$total_vac)

df_22_omrade <- df_22_omrade %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         workplace_address.municipality_code = factor(workplace_address.municipality_code, 
                                                      levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))

color_mapping <- c("2313" = "#FF7F00", "2309" = "#FDBF6F", "2321" = "#E31A1C", "2380" = "#FB9A99", 
                            "2303" = "#33A02C", "2305" = "#B2DF8A", "2326" = "#1F78B4", "2361" = "#A6CEE3")

ggplot(df_22_omrade, aes(x = ssyk3_text, y = total_vac, fill = factor(workplace_address.municipality_code, levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  #scale_fill_viridis(discrete = TRUE, direction = 1, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Frsj., inköp, marknadsföring, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()


```
*Kommunkod: 2313 - Strömsund, 2309 - Krokom, 2321 - Åre, 2380 - Östersund, 2303 - Ragunda, 2305 - Bräcke, 2326 - Berg, 2361 - Härjedalen. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

## Hantverk

```{r omradeH_SSYK_kval_22, message=FALSE, warning=FALSE, fig.align = "center"}
# Filter the data based on the condition
df_22_omrade_kval <- filter(df, occupation_field.label == "Hantverk")

# Check if any rows match the condition
if (nrow(df_22_omrade_kval) == 0) {
  # Handle the case where there are no rows matching the condition
  # For example, print a message or take alternative actions
  print("Inga annonser.")
} else {
  # Proceed with further operations
  df_22_omrade_kval <- df_22_omrade_kval %>%
    group_by(ssyk3_text, ssyk3_code, kvalifikations_niva) %>%
    summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
    ungroup()

  max_value <- max(df_22_omrade_kval$total_vac)


  df_22_omrade_kval$total_vac <- as.numeric(df_22_omrade_kval$total_vac)
  
  df_22_omrade_kval <- df_22_omrade_kval %>%
    mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
           kvalifikations_niva = factor(kvalifikations_niva, levels = c("1", "2", "3", "4")))
  
  
  color_mapping <- c("1" = "#FDE725", "2" = "#35B779", "3" = "#31688E", "4" = "#440154")
  
  
  ggplot(df_22_omrade_kval, aes(x = ssyk3_text, y = total_vac, fill = factor(kvalifikations_niva, levels = c("4", "3", "2", "1")))) +
    geom_col() +
    scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
    geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
    theme_tufte() +
    theme(plot.title = element_text(size = 14, face = "bold"),
          legend.title = element_blank(),
          legend.position = "bottom",
          axis.ticks.x = element_blank()) +
    labs(title = "Lediga tjänster",
         subtitle = sprintf("Hantverk, SSYK3 - %s", geografi),
         y = "Tjänster",
         x = "",
         caption = "Källa: Af och bearbetningar av Region Västernorrland") +
    scale_y_continuous(labels = number_format(accuracy = 1))+
    coord_flip()
}
```
*1 - Inga eller låga formella utbildningskrav, 2 - Gymnasie eller eftergymnasial utbildning kortare än 2 år, 3 - Praktiska eller yrkesspecifika eftergymnasiala utbildningar på 2-3 år, 4 - Teoretiska eftergymnasiala utbildningar om minst 3 år. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

```{r omradeH_SSYK_kommun_22, message=FALSE, warning=FALSE, fig.align = "center"}

## Filter on 22
df_22_omrade <- filter(df, occupation_field.label == "Hantverk")

if (nrow(df_22_omrade)==0) {
  print("Inga annonser.")
} else {

  df_22_omrade <- df_22_omrade %>%
    group_by(ssyk3_text, workplace_address.municipality_code) %>%
    summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
    ungroup()
  
  max_value <- df_22_omrade %>%
    group_by(ssyk3_text) %>%
    summarize(total_vac_sum = sum(total_vac)) %>%
    arrange(desc(total_vac_sum)) %>%
    slice(1) %>%
    pull(total_vac_sum)
  
  
  df_22_omrade$total_vac <- as.numeric(df_22_omrade$total_vac)
  
  df_22_omrade <- df_22_omrade %>%
    mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
           workplace_address.municipality_code = factor(workplace_address.municipality_code, 
                                                        levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))
  
  color_mapping <- c("2313" = "#FF7F00", "2309" = "#FDBF6F", "2321" = "#E31A1C", "2380" = "#FB9A99", 
                              "2303" = "#33A02C", "2305" = "#B2DF8A", "2326" = "#1F78B4", "2361" = "#A6CEE3")
  
  ggplot(df_22_omrade, aes(x = ssyk3_text, y = total_vac, fill = factor(workplace_address.municipality_code, levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))) +
    geom_col() +
    scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
    #scale_fill_viridis(discrete = TRUE, direction = 1, guide = guide_legend(reverse = TRUE)) +
    geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
    theme_tufte() +
    theme(plot.title = element_text(size = 14, face = "bold"),
          legend.title = element_blank(),
          legend.position = "bottom",
          axis.ticks.x = element_blank()) +
    labs(title = "Lediga tjänster",
         subtitle = sprintf("Hantverk, SSYK3 - %s", geografi),
         y = "Tjänster",
         x = "",
         caption = "Källa: Af och bearbetningar av Region Västernorrland") +
    scale_y_continuous(labels = number_format(accuracy = 1))+
    coord_flip()

}
```
*Kommunkod: 2313 - Strömsund, 2309 - Krokom, 2321 - Åre, 2380 - Östersund, 2303 - Ragunda, 2305 - Bräcke, 2326 - Berg, 2361 - Härjedalen. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

## Hotell, rest., storhushåll

```{r omradeHRS_SSYK_kval_22, message=FALSE, warning=FALSE, fig.align = "center"}
## Filter
df_22_omrade_kval <- filter(df, occupation_field.label == "Hotell, restaurang, storhushåll")

df_22_omrade_kval <- df_22_omrade_kval %>%
  group_by(ssyk3_text, ssyk3_code, kvalifikations_niva) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_omrade_kval %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade_kval$total_vac <- as.numeric(df_22_omrade_kval$total_vac)

df_22_omrade_kval <- df_22_omrade_kval %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         kvalifikations_niva = factor(kvalifikations_niva, levels = c("1", "2", "3", "4")))


color_mapping <- c("1" = "#FDE725", "2" = "#35B779", "3" = "#31688E", "4" = "#440154")


ggplot(df_22_omrade_kval, aes(x = ssyk3_text, y = total_vac, fill = factor(kvalifikations_niva, levels = c("4", "3", "2", "1")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Hotell, rest., storhushåll, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()
```
*1 - Inga eller låga formella utbildningskrav, 2 - Gymnasie eller eftergymnasial utbildning kortare än 2 år, 3 - Praktiska eller yrkesspecifika eftergymnasiala utbildningar på 2-3 år, 4 - Teoretiska eftergymnasiala utbildningar om minst 3 år. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

```{r omradeHRS_SSYK_kommun_22, message=FALSE, warning=FALSE, fig.align = "center"}

## Filter on 22
df_22_omrade <- filter(df, occupation_field.label == "Hotell, restaurang, storhushåll")

df_22_omrade <- df_22_omrade %>%
  group_by(ssyk3_text, workplace_address.municipality_code) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_omrade %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade$total_vac <- as.numeric(df_22_omrade$total_vac)

df_22_omrade <- df_22_omrade %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         workplace_address.municipality_code = factor(workplace_address.municipality_code, 
                                                      levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))

color_mapping <- c("2313" = "#FF7F00", "2309" = "#FDBF6F", "2321" = "#E31A1C", "2380" = "#FB9A99", 
                            "2303" = "#33A02C", "2305" = "#B2DF8A", "2326" = "#1F78B4", "2361" = "#A6CEE3")

ggplot(df_22_omrade, aes(x = ssyk3_text, y = total_vac, fill = factor(workplace_address.municipality_code, levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  #scale_fill_viridis(discrete = TRUE, direction = 1, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Hotell, rest., storhushåll, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()


```
*Kommunkod: 2313 - Strömsund, 2309 - Krokom, 2321 - Åre, 2380 - Östersund, 2303 - Ragunda, 2305 - Bräcke, 2326 - Berg, 2361 - Härjedalen. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

## Hälso- och sjukvård

```{r omradeHS_SSYK_kval_22, message=FALSE, warning=FALSE, fig.align = "center"}

df_22_omrade_kval <- filter(df, occupation_field.label == "Hälso- och sjukvård")

df_22_omrade_kval <- df_22_omrade_kval %>%
  group_by(ssyk3_text, ssyk3_code, kvalifikations_niva) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_omrade_kval %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade_kval$total_vac <- as.numeric(df_22_omrade_kval$total_vac)

df_22_omrade_kval <- df_22_omrade_kval %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         kvalifikations_niva = factor(kvalifikations_niva, levels = c("1", "2", "3", "4")))


color_mapping <- c("1" = "#FDE725", "2" = "#35B779", "3" = "#31688E", "4" = "#440154")


ggplot(df_22_omrade_kval, aes(x = ssyk3_text, y = total_vac, fill = factor(kvalifikations_niva, levels = c("4", "3", "2", "1")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Hälso- och sjukvård, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()
```
*1 - Inga eller låga formella utbildningskrav, 2 - Gymnasie eller eftergymnasial utbildning kortare än 2 år, 3 - Praktiska eller yrkesspecifika eftergymnasiala utbildningar på 2-3 år, 4 - Teoretiska eftergymnasiala utbildningar om minst 3 år. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

```{r omradeHS_SSYK_kommun_22, message=FALSE, warning=FALSE, fig.align = "center"}

## Filter on 22
df_22_omrade <- filter(df, occupation_field.label == "Hälso- och sjukvård")

df_22_omrade <- df_22_omrade %>%
  group_by(ssyk3_text, workplace_address.municipality_code) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_omrade %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade$total_vac <- as.numeric(df_22_omrade$total_vac)

df_22_omrade <- df_22_omrade %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         workplace_address.municipality_code = factor(workplace_address.municipality_code, 
                                                      levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))

color_mapping <- c("2313" = "#FF7F00", "2309" = "#FDBF6F", "2321" = "#E31A1C", "2380" = "#FB9A99", 
                            "2303" = "#33A02C", "2305" = "#B2DF8A", "2326" = "#1F78B4", "2361" = "#A6CEE3")

ggplot(df_22_omrade, aes(x = ssyk3_text, y = total_vac, fill = factor(workplace_address.municipality_code, levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  #scale_fill_viridis(discrete = TRUE, direction = 1, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Hälso- och sjukvård, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()


```
*Kommunkod: 2313 - Strömsund, 2309 - Krokom, 2321 - Åre, 2380 - Östersund, 2303 - Ragunda, 2305 - Bräcke, 2326 - Berg, 2361 - Härjedalen. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

## Industriell tillverkning

```{r omradeITv_SSYK_kval_22, message=FALSE, warning=FALSE, fig.align = "center"}
## Filter
df_22_omrade_kval <- filter(df, occupation_field.label == "Industriell tillverkning")

df_22_omrade_kval <- df_22_omrade_kval %>%
  group_by(ssyk3_text, ssyk3_code, kvalifikations_niva) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_omrade_kval %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade_kval$total_vac <- as.numeric(df_22_omrade_kval$total_vac)

df_22_omrade_kval <- df_22_omrade_kval %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         kvalifikations_niva = factor(kvalifikations_niva, levels = c("1", "2", "3", "4")))


color_mapping <- c("1" = "#FDE725", "2" = "#35B779", "3" = "#31688E", "4" = "#440154")


ggplot(df_22_omrade_kval, aes(x = ssyk3_text, y = total_vac, fill = factor(kvalifikations_niva, levels = c("4", "3", "2", "1")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Industriell tillverkning, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()
```
*1 - Inga eller låga formella utbildningskrav, 2 - Gymnasie eller eftergymnasial utbildning kortare än 2 år, 3 - Praktiska eller yrkesspecifika eftergymnasiala utbildningar på 2-3 år, 4 - Teoretiska eftergymnasiala utbildningar om minst 3 år. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

```{r omradeITv_SSYK_kommun_22, message=FALSE, warning=FALSE, fig.align = "center"}

## Filter on 22
df_22_omrade <- filter(df, occupation_field.label == "Industriell tillverkning")

df_22_omrade <- df_22_omrade %>%
  group_by(ssyk3_text, workplace_address.municipality_code) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_omrade %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade$total_vac <- as.numeric(df_22_omrade$total_vac)

df_22_omrade <- df_22_omrade %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         workplace_address.municipality_code = factor(workplace_address.municipality_code, 
                                                      levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))

color_mapping <- c("2313" = "#FF7F00", "2309" = "#FDBF6F", "2321" = "#E31A1C", "2380" = "#FB9A99", 
                            "2303" = "#33A02C", "2305" = "#B2DF8A", "2326" = "#1F78B4", "2361" = "#A6CEE3")

ggplot(df_22_omrade, aes(x = ssyk3_text, y = total_vac, fill = factor(workplace_address.municipality_code, levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  #scale_fill_viridis(discrete = TRUE, direction = 1, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Industriell tillverkning, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()


```
*Kommunkod: 2313 - Strömsund, 2309 - Krokom, 2321 - Åre, 2380 - Östersund, 2303 - Ragunda, 2305 - Bräcke, 2326 - Berg, 2361 - Härjedalen. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

## Installation, drift, underhåll

```{r omradeIDU_SSYK_kval_22, message=FALSE, warning=FALSE, fig.align = "center"}
## Filter
df_22_omrade_kval <- filter(df, occupation_field.label == "Installation, drift, underhåll")

df_22_omrade_kval <- df_22_omrade_kval %>%
  group_by(ssyk3_text, ssyk3_code, kvalifikations_niva) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_omrade_kval %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade_kval$total_vac <- as.numeric(df_22_omrade_kval$total_vac)

df_22_omrade_kval <- df_22_omrade_kval %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         kvalifikations_niva = factor(kvalifikations_niva, levels = c("1", "2", "3", "4")))


color_mapping <- c("1" = "#FDE725", "2" = "#35B779", "3" = "#31688E", "4" = "#440154")


ggplot(df_22_omrade_kval, aes(x = ssyk3_text, y = total_vac, fill = factor(kvalifikations_niva, levels = c("4", "3", "2", "1")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Installation, drift, underhåll, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()
```
*1 - Inga eller låga formella utbildningskrav, 2 - Gymnasie eller eftergymnasial utbildning kortare än 2 år, 3 - Praktiska eller yrkesspecifika eftergymnasiala utbildningar på 2-3 år, 4 - Teoretiska eftergymnasiala utbildningar om minst 3 år. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

```{r omradeIDU_SSYK_kommun_22, message=FALSE, warning=FALSE, fig.align = "center"}

## Filter on 22
df_22_omrade <- filter(df, occupation_field.label == "Installation, drift, underhåll")

df_22_omrade <- df_22_omrade %>%
  group_by(ssyk3_text, workplace_address.municipality_code) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_omrade %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade$total_vac <- as.numeric(df_22_omrade$total_vac)

df_22_omrade <- df_22_omrade %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         workplace_address.municipality_code = factor(workplace_address.municipality_code, 
                                                      levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))

color_mapping <- c("2313" = "#FF7F00", "2309" = "#FDBF6F", "2321" = "#E31A1C", "2380" = "#FB9A99", 
                            "2303" = "#33A02C", "2305" = "#B2DF8A", "2326" = "#1F78B4", "2361" = "#A6CEE3")

ggplot(df_22_omrade, aes(x = ssyk3_text, y = total_vac, fill = factor(workplace_address.municipality_code, levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  #scale_fill_viridis(discrete = TRUE, direction = 1, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Installation, drift, underhåll, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()


```
*Kommunkod: 2313 - Strömsund, 2309 - Krokom, 2321 - Åre, 2380 - Östersund, 2303 - Ragunda, 2305 - Bräcke, 2326 - Berg, 2361 - Härjedalen. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

## Kropps- och skönhetsvård

```{r omradeKS_SSYK_kval_22, message=FALSE, warning=FALSE, fig.align = "center"}
## Filter
df_22_omrade_kval <- filter(df, occupation_field.label == "Kropps- och skönhetsvård")

# Check if df_22_omrade_kval is empty
if (nrow(df_22_omrade_kval) == 0) {
  message("The dataframe is empty. Skipping this chunk.")
  knitr::opts_chunk$set(error = FALSE)  # Stop chunk execution here
} else {
  df_22_omrade_kval <- df_22_omrade_kval %>%
    group_by(ssyk3_text, ssyk3_code, kvalifikations_niva) %>%
    summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
    ungroup()

  max_value <- df_22_omrade_kval %>%
    group_by(ssyk3_text) %>%
    summarize(total_vac_sum = sum(total_vac)) %>%
    arrange(desc(total_vac_sum)) %>%
    slice(1) %>%
    pull(total_vac_sum)
  
  
  df_22_omrade_kval$total_vac <- as.numeric(df_22_omrade_kval$total_vac)
  
  df_22_omrade_kval <- df_22_omrade_kval %>%
    mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
           kvalifikations_niva = factor(kvalifikations_niva, levels = c("1", "2", "3", "4")))
  
  
  color_mapping <- c("1" = "#FDE725", "2" = "#35B779", "3" = "#31688E", "4" = "#440154")
  
  
  gg<-ggplot(df_22_omrade_kval, aes(x = ssyk3_text, y = total_vac, fill = factor(kvalifikations_niva, levels = c("4", "3", "2", "1")))) +
    geom_col() +
    scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
    geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
    theme_tufte() +
    theme(plot.title = element_text(size = 14, face = "bold"),
          legend.title = element_blank(),
          legend.position = "bottom",
          axis.ticks.x = element_blank()) +
    labs(title = "Lediga tjänster",
         subtitle = sprintf("Kropps- och skönhetsvård, SSYK3 - %s", geografi),
         y = "Tjänster",
         x = "",
         caption = "Källa: Af och bearbetningar av Region Västernorrland") +
    scale_y_continuous(labels = number_format(accuracy = 1))+
    coord_flip()
 
    # Check if df_22_omrade_kval is not empty before adding geom_hline
  if (!is_empty(df_22_omrade_kval)) {
    gg <- gg + geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white")
  }

  gg  # Display the plot
   
}
```
*1 - Inga eller låga formella utbildningskrav, 2 - Gymnasie eller eftergymnasial utbildning kortare än 2 år, 3 - Praktiska eller yrkesspecifika eftergymnasiala utbildningar på 2-3 år, 4 - Teoretiska eftergymnasiala utbildningar om minst 3 år. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

```{r omradeKS_SSYK_kommun_22, message=FALSE, warning=FALSE, fig.align = "center"}

## Filter on 22
df_22_omrade <- filter(df, occupation_field.label == "Kropps- och skönhetsvård")

# Check if df_22_omrade_kval is empty
if (nrow(df_22_omrade) == 0) {
  message("The dataframe is empty. Skipping this chunk.")
  knitr::opts_chunk$set(error = FALSE)  # Stop chunk execution here
} else {

  df_22_omrade <- df_22_omrade %>%
    group_by(ssyk3_text, workplace_address.municipality_code) %>%
    summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
    ungroup()
  
  max_value <- df_22_omrade %>%
    group_by(ssyk3_text) %>%
    summarize(total_vac_sum = sum(total_vac)) %>%
    arrange(desc(total_vac_sum)) %>%
    slice(1) %>%
    pull(total_vac_sum)
  
  
  df_22_omrade$total_vac <- as.numeric(df_22_omrade$total_vac)
  
  df_22_omrade <- df_22_omrade %>%
    mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
           workplace_address.municipality_code = factor(workplace_address.municipality_code, 
                                                        levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))
  
  color_mapping <- c("2313" = "#FF7F00", "2309" = "#FDBF6F", "2321" = "#E31A1C", "2380" = "#FB9A99", 
                              "2303" = "#33A02C", "2305" = "#B2DF8A", "2326" = "#1F78B4", "2361" = "#A6CEE3")
  
  gg<-ggplot(df_22_omrade, aes(x = ssyk3_text, y = total_vac, fill = factor(workplace_address.municipality_code, levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))) +
    geom_col() +
    scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
    #scale_fill_viridis(discrete = TRUE, direction = 1, guide = guide_legend(reverse = TRUE)) +
    geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
    theme_tufte() +
    theme(plot.title = element_text(size = 14, face = "bold"),
          legend.title = element_blank(),
          legend.position = "bottom",
          axis.ticks.x = element_blank()) +
    labs(title = "Lediga tjänster",
         subtitle = sprintf("Kropps- och skönhetsvård, SSYK3 - %s", geografi),
         y = "Tjänster",
         x = "",
         caption = "Källa: Af och bearbetningar av Region Västernorrland") +
    scale_y_continuous(labels = number_format(accuracy = 1))+
    coord_flip()

  # Check if df_22_omrade_kval is not empty before adding geom_hline
  if (!is_empty(df_22_omrade_kval)) {
    gg <- gg + geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white")
  }

  gg  # Display the plot
  
}
```
*Kommunkod: 2313 - Strömsund, 2309 - Krokom, 2321 - Åre, 2380 - Östersund, 2303 - Ragunda, 2305 - Bräcke, 2326 - Berg, 2361 - Härjedalen. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

## Kultur, media, design

```{r omradeKMD_SSYK_kval_22, message=FALSE, warning=FALSE, fig.align = "center"}
## Filter
df_22_omrade_kval <- filter(df, occupation_field.label == "Kultur, media, design")

# Check if df_22_omrade_kval is empty
if (nrow(df_22_omrade_kval) == 0) {
  message("The dataframe is empty. Skipping this chunk.")
  knitr::opts_chunk$set(error = FALSE)  # Stop chunk execution here
} else {
  df_22_omrade_kval <- df_22_omrade_kval %>%
    group_by(ssyk3_text, ssyk3_code, kvalifikations_niva) %>%
    summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
    ungroup()

max_value <- df_22_omrade_kval %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade_kval$total_vac <- as.numeric(df_22_omrade_kval$total_vac)

df_22_omrade_kval <- df_22_omrade_kval %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         kvalifikations_niva = factor(kvalifikations_niva, levels = c("1", "2", "3", "4")))


color_mapping <- c("1" = "#FDE725", "2" = "#35B779", "3" = "#31688E", "4" = "#440154")


gg<-ggplot(df_22_omrade_kval, aes(x = ssyk3_text, y = total_vac, fill = factor(kvalifikations_niva, levels = c("4", "3", "2", "1")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Kultur, media, design, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()

  # Check if df_22_omrade_kval is not empty before adding geom_hline
  if (!is_empty(df_22_omrade_kval)) {
    gg <- gg + geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white")
  }

  gg  # Display the plot

}
```
*1 - Inga eller låga formella utbildningskrav, 2 - Gymnasie eller eftergymnasial utbildning kortare än 2 år, 3 - Praktiska eller yrkesspecifika eftergymnasiala utbildningar på 2-3 år, 4 - Teoretiska eftergymnasiala utbildningar om minst 3 år. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

```{r omradeKMD_SSYK_kommun_22, message=FALSE, warning=FALSE, fig.align = "center"}

## Filter on 22
df_22_omrade <- filter(df, occupation_field.label == "Kultur, media, design")

# Check if df_22_omrade_kval is empty
if (nrow(df_22_omrade) == 0) {
  message("The dataframe is empty. Skipping this chunk.")
  knitr::opts_chunk$set(error = FALSE)  # Stop chunk execution here
} else {

df_22_omrade <- df_22_omrade %>%
  group_by(ssyk3_text, workplace_address.municipality_code) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_omrade %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade$total_vac <- as.numeric(df_22_omrade$total_vac)

df_22_omrade <- df_22_omrade %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         workplace_address.municipality_code = factor(workplace_address.municipality_code, 
                                                      levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))

color_mapping <- c("2313" = "#FF7F00", "2309" = "#FDBF6F", "2321" = "#E31A1C", "2380" = "#FB9A99", 
                            "2303" = "#33A02C", "2305" = "#B2DF8A", "2326" = "#1F78B4", "2361" = "#A6CEE3")

gg<-ggplot(df_22_omrade, aes(x = ssyk3_text, y = total_vac, fill = factor(workplace_address.municipality_code, levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  #scale_fill_viridis(discrete = TRUE, direction = 1, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Kultur, media, design, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()

# Check if df_22_omrade_kval is not empty before adding geom_hline
  if (!is_empty(df_22_omrade_kval)) {
    gg <- gg + geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white")
  }

  gg  # Display the plot

}
```
*Kommunkod: 2313 - Strömsund, 2309 - Krokom, 2321 - Åre, 2380 - Östersund, 2303 - Ragunda, 2305 - Bräcke, 2326 - Berg, 2361 - Härjedalen. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

## Militära yrken

```{r omradeM_SSYK_kval_22, message=FALSE, warning=FALSE, fig.align = "center"}
## Filter
df_22_omrade_kval <- filter(df, occupation_field.label == "Militära yrken")

# Check if df_22_omrade_kval is empty
if (nrow(df_22_omrade_kval) == 0) {
  message("The dataframe is empty. Skipping this chunk.")
  knitr::opts_chunk$set(error = FALSE)  # Stop chunk execution here
} else {
  df_22_omrade_kval <- df_22_omrade_kval %>%
    group_by(ssyk3_text, ssyk3_code, kvalifikations_niva) %>%
    summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
    ungroup()

max_value <- df_22_omrade_kval %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade_kval$total_vac <- as.numeric(df_22_omrade_kval$total_vac)

df_22_omrade_kval <- df_22_omrade_kval %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         kvalifikations_niva = factor(kvalifikations_niva, levels = c("1", "2", "3", "4")))


color_mapping <- c("1" = "#FDE725", "2" = "#35B779", "3" = "#31688E", "4" = "#440154")


gg<-ggplot(df_22_omrade_kval, aes(x = ssyk3_text, y = total_vac, fill = factor(kvalifikations_niva, levels = c("4", "3", "2", "1")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Militära yrken, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()

  # Check if df_22_omrade_kval is not empty before adding geom_hline
  if (!is_empty(df_22_omrade_kval)) {
    gg <- gg + geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white")
  }

  gg  # Display the plot

}
```
*1 - Inga eller låga formella utbildningskrav, 2 - Gymnasie eller eftergymnasial utbildning kortare än 2 år, 3 - Praktiska eller yrkesspecifika eftergymnasiala utbildningar på 2-3 år, 4 - Teoretiska eftergymnasiala utbildningar om minst 3 år. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

```{r omradeM_SSYK_kommun_22, message=FALSE, warning=FALSE, fig.align = "center"}

## Filter on 22
df_22_omrade <- filter(df, occupation_field.label == "Militära yrken")

# Check if df_22_omrade_kval is empty
if (nrow(df_22_omrade) == 0) {
  message("The dataframe is empty. Skipping this chunk.")
  knitr::opts_chunk$set(error = FALSE)  # Stop chunk execution here
} else {
  df_22_omrade <- df_22_omrade %>%
  group_by(ssyk3_text, workplace_address.municipality_code) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()


max_value <- df_22_omrade %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade$total_vac <- as.numeric(df_22_omrade$total_vac)

df_22_omrade <- df_22_omrade %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         workplace_address.municipality_code = factor(workplace_address.municipality_code, 
                                                      levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))

color_mapping <- c("2313" = "#FF7F00", "2309" = "#FDBF6F", "2321" = "#E31A1C", "2380" = "#FB9A99", 
                            "2303" = "#33A02C", "2305" = "#B2DF8A", "2326" = "#1F78B4", "2361" = "#A6CEE3")

gg<-ggplot(df_22_omrade, aes(x = ssyk3_text, y = total_vac, fill = factor(workplace_address.municipality_code, levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  #scale_fill_viridis(discrete = TRUE, direction = 1, guide = guide_legend(reverse = TRUE)) +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Militära yrken, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()

  # Check if df_22_omrade_kval is not empty before adding geom_hline
  if (!is_empty(df_22_omrade_kval)) {
    gg <- gg + geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white")
  }

  gg  # Display the plot

}
```
*Kommunkod: 2313 - Strömsund, 2309 - Krokom, 2321 - Åre, 2380 - Östersund, 2303 - Ragunda, 2305 - Bräcke, 2326 - Berg, 2361 - Härjedalen. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

## Naturbruk

```{r omradeN_SSYK_kval_22, message=FALSE, warning=FALSE, fig.align = "center"}
## Filter
df_22_omrade_kval <- filter(df, occupation_field.label == "Naturbruk")

df_22_omrade_kval <- df_22_omrade_kval %>%
  group_by(ssyk3_text, ssyk3_code, kvalifikations_niva) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_omrade_kval %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade_kval$total_vac <- as.numeric(df_22_omrade_kval$total_vac)

df_22_omrade_kval <- df_22_omrade_kval %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         kvalifikations_niva = factor(kvalifikations_niva, levels = c("1", "2", "3", "4")))


color_mapping <- c("1" = "#FDE725", "2" = "#35B779", "3" = "#31688E", "4" = "#440154")


ggplot(df_22_omrade_kval, aes(x = ssyk3_text, y = total_vac, fill = factor(kvalifikations_niva, levels = c("4", "3", "2", "1")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Naturbruk, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()
```
*1 - Inga eller låga formella utbildningskrav, 2 - Gymnasie eller eftergymnasial utbildning kortare än 2 år, 3 - Praktiska eller yrkesspecifika eftergymnasiala utbildningar på 2-3 år, 4 - Teoretiska eftergymnasiala utbildningar om minst 3 år. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

```{r omradeN_SSYK_kommun_22, message=FALSE, warning=FALSE, fig.align = "center"}

## Filter on 22
df_22_omrade <- filter(df, occupation_field.label == "Naturbruk")

df_22_omrade <- df_22_omrade %>%
  group_by(ssyk3_text, workplace_address.municipality_code) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_omrade %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade$total_vac <- as.numeric(df_22_omrade$total_vac)

df_22_omrade <- df_22_omrade %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         workplace_address.municipality_code = factor(workplace_address.municipality_code, 
                                                      levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))

color_mapping <- c("2313" = "#FF7F00", "2309" = "#FDBF6F", "2321" = "#E31A1C", "2380" = "#FB9A99", 
                            "2303" = "#33A02C", "2305" = "#B2DF8A", "2326" = "#1F78B4", "2361" = "#A6CEE3")

ggplot(df_22_omrade, aes(x = ssyk3_text, y = total_vac, fill = factor(workplace_address.municipality_code, levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  #scale_fill_viridis(discrete = TRUE, direction = 1, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Naturbruk, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()


```
*Kommunkod: 2313 - Strömsund, 2309 - Krokom, 2321 - Åre, 2380 - Östersund, 2303 - Ragunda, 2305 - Bräcke, 2326 - Berg, 2361 - Härjedalen. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

## Naturvetenskap

```{r omradeNa_SSYK_kval_22, message=FALSE, warning=FALSE, fig.align = "center"}
# INPUT
filter <- "Naturvetenskap"

## Filter
df_22_omrade_kval <- filter(df, occupation_field.label == filter)

# Check if df_22_omrade_kval is empty
if (nrow(df_22_omrade_kval) == 0) {
  message("The dataframe is empty. Skipping this chunk.")
  knitr::opts_chunk$set(error = FALSE)  # Stop chunk execution here
} else {
  df_22_omrade_kval <- df_22_omrade_kval %>%
    group_by(ssyk3_text, ssyk3_code, kvalifikations_niva) %>%
    summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
    ungroup()

max_value <- df_22_omrade_kval %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade_kval$total_vac <- as.numeric(df_22_omrade_kval$total_vac)

df_22_omrade_kval <- df_22_omrade_kval %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         kvalifikations_niva = factor(kvalifikations_niva, levels = c("1", "2", "3", "4")))


color_mapping <- c("1" = "#FDE725", "2" = "#35B779", "3" = "#31688E", "4" = "#440154")

gg<-ggplot(df_22_omrade_kval, aes(x = ssyk3_text, y = total_vac, fill = factor(kvalifikations_niva, levels = c("4", "3", "2", "1")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("%s, SSYK3 - %s", filter, geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()

  # Check if df_22_omrade_kval is not empty before adding geom_hline
  if (!is_empty(df_22_omrade_kval)) {
    gg <- gg + geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white")
  }

  gg  # Display the plot

}
```
*1 - Inga eller låga formella utbildningskrav, 2 - Gymnasie eller eftergymnasial utbildning kortare än 2 år, 3 - Praktiska eller yrkesspecifika eftergymnasiala utbildningar på 2-3 år, 4 - Teoretiska eftergymnasiala utbildningar om minst 3 år. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

```{r omradeNa_SSYK_kommun_22, message=FALSE, warning=FALSE, fig.align = "center"}

## Filter on 22
df_22_omrade <- filter(df, occupation_field.label == filter)

# Check if df_22_omrade_kval is empty
if (nrow(df_22_omrade) == 0) {
  message("The dataframe is empty. Skipping this chunk.")
  knitr::opts_chunk$set(error = FALSE)  # Stop chunk execution here
} else {
  df_22_omrade <- df_22_omrade %>%
  group_by(ssyk3_text, workplace_address.municipality_code) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()


max_value <- df_22_omrade %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade$total_vac <- as.numeric(df_22_omrade$total_vac)

df_22_omrade <- df_22_omrade %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         workplace_address.municipality_code = factor(workplace_address.municipality_code, 
                                                      levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))

color_mapping <- c("2313" = "#FF7F00", "2309" = "#FDBF6F", "2321" = "#E31A1C", "2380" = "#FB9A99", 
                            "2303" = "#33A02C", "2305" = "#B2DF8A", "2326" = "#1F78B4", "2361" = "#A6CEE3")

gg<-ggplot(df_22_omrade, aes(x = ssyk3_text, y = total_vac, fill = factor(workplace_address.municipality_code, levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  #scale_fill_viridis(discrete = TRUE, direction = 1, guide = guide_legend(reverse = TRUE)) +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("%s, SSYK3 - %s",filter, geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()

  # Check if df_22_omrade_kval is not empty before adding geom_hline
  if (!is_empty(df_22_omrade_kval)) {
    gg <- gg + geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white")
  }

  gg  # Display the plot

}
```
*Kommunkod: 2313 - Strömsund, 2309 - Krokom, 2321 - Åre, 2380 - Östersund, 2303 - Ragunda, 2305 - Bräcke, 2326 - Berg, 2361 - Härjedalen. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

## Pedagogik

```{r omradeP_SSYK_kval_22, message=FALSE, warning=FALSE, fig.align = "center"}
## Filter
df_22_omrade_kval <- filter(df,occupation_field.label == "Pedagogik")

df_22_omrade_kval <- df_22_omrade_kval %>%
  group_by(ssyk3_text, ssyk3_code, kvalifikations_niva) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_omrade_kval %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade_kval$total_vac <- as.numeric(df_22_omrade_kval$total_vac)

df_22_omrade_kval <- df_22_omrade_kval %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         kvalifikations_niva = factor(kvalifikations_niva, levels = c("1", "2", "3", "4")))


color_mapping <- c("1" = "#FDE725", "2" = "#35B779", "3" = "#31688E", "4" = "#440154")


ggplot(df_22_omrade_kval, aes(x = ssyk3_text, y = total_vac, fill = factor(kvalifikations_niva, levels = c("4", "3", "2", "1")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Pedagogik, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()
```
*1 - Inga eller låga formella utbildningskrav, 2 - Gymnasie eller eftergymnasial utbildning kortare än 2 år, 3 - Praktiska eller yrkesspecifika eftergymnasiala utbildningar på 2-3 år, 4 - Teoretiska eftergymnasiala utbildningar om minst 3 år. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

```{r omradeP_SSYK_kommun_22, message=FALSE, warning=FALSE, fig.align = "center"}

## Filter on 22
df_22_omrade <- filter(df, occupation_field.label == "Pedagogik")

df_22_omrade <- df_22_omrade %>%
  group_by(ssyk3_text, workplace_address.municipality_code) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_omrade %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade$total_vac <- as.numeric(df_22_omrade$total_vac)

df_22_omrade <- df_22_omrade %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         workplace_address.municipality_code = factor(workplace_address.municipality_code, 
                                                      levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))

color_mapping <- c("2313" = "#FF7F00", "2309" = "#FDBF6F", "2321" = "#E31A1C", "2380" = "#FB9A99", 
                            "2303" = "#33A02C", "2305" = "#B2DF8A", "2326" = "#1F78B4", "2361" = "#A6CEE3")

ggplot(df_22_omrade, aes(x = ssyk3_text, y = total_vac, fill = factor(workplace_address.municipality_code, levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  #scale_fill_viridis(discrete = TRUE, direction = 1, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Pedagogik, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()


```
*Kommunkod: 2313 - Strömsund, 2309 - Krokom, 2321 - Åre, 2380 - Östersund, 2303 - Ragunda, 2305 - Bräcke, 2326 - Berg, 2361 - Härjedalen. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

## Pedagogiskt arbete

```{r omradePe_SSYK_kval_22, message=FALSE, warning=FALSE, fig.align = "center"}
# INPUT
filter <- "Pedagogiskt arbete"

## Filter
df_22_omrade_kval <- filter(df, occupation_field.label == filter)

# Check if df_22_omrade_kval is empty
if (nrow(df_22_omrade_kval) == 0) {
  message("The dataframe is empty. Skipping this chunk.")
  knitr::opts_chunk$set(error = FALSE)  # Stop chunk execution here
} else {
  df_22_omrade_kval <- df_22_omrade_kval %>%
    group_by(ssyk3_text, ssyk3_code, kvalifikations_niva) %>%
    summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
    ungroup()

max_value <- df_22_omrade_kval %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade_kval$total_vac <- as.numeric(df_22_omrade_kval$total_vac)

df_22_omrade_kval <- df_22_omrade_kval %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         kvalifikations_niva = factor(kvalifikations_niva, levels = c("1", "2", "3", "4")))


color_mapping <- c("1" = "#FDE725", "2" = "#35B779", "3" = "#31688E", "4" = "#440154")

gg<-ggplot(df_22_omrade_kval, aes(x = ssyk3_text, y = total_vac, fill = factor(kvalifikations_niva, levels = c("4", "3", "2", "1")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("%s, SSYK3 - %s", filter, geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()

  # Check if df_22_omrade_kval is not empty before adding geom_hline
  if (!is_empty(df_22_omrade_kval)) {
    gg <- gg + geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white")
  }

  gg  # Display the plot

}
```
*1 - Inga eller låga formella utbildningskrav, 2 - Gymnasie eller eftergymnasial utbildning kortare än 2 år, 3 - Praktiska eller yrkesspecifika eftergymnasiala utbildningar på 2-3 år, 4 - Teoretiska eftergymnasiala utbildningar om minst 3 år. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

```{r omradePe_SSYK_kommun_22, message=FALSE, warning=FALSE, fig.align = "center"}

## Filter on 22
df_22_omrade <- filter(df, occupation_field.label == filter)

# Check if df_22_omrade_kval is empty
if (nrow(df_22_omrade) == 0) {
  message("The dataframe is empty. Skipping this chunk.")
  knitr::opts_chunk$set(error = FALSE)  # Stop chunk execution here
} else {
  df_22_omrade <- df_22_omrade %>%
  group_by(ssyk3_text, workplace_address.municipality_code) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()


max_value <- df_22_omrade %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade$total_vac <- as.numeric(df_22_omrade$total_vac)

df_22_omrade <- df_22_omrade %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         workplace_address.municipality_code = factor(workplace_address.municipality_code, 
                                                      levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))

color_mapping <- c("2313" = "#FF7F00", "2309" = "#FDBF6F", "2321" = "#E31A1C", "2380" = "#FB9A99", 
                            "2303" = "#33A02C", "2305" = "#B2DF8A", "2326" = "#1F78B4", "2361" = "#A6CEE3")

gg<-ggplot(df_22_omrade, aes(x = ssyk3_text, y = total_vac, fill = factor(workplace_address.municipality_code, levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  #scale_fill_viridis(discrete = TRUE, direction = 1, guide = guide_legend(reverse = TRUE)) +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("%s, SSYK3 - %s",filter, geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()

  # Check if df_22_omrade_kval is not empty before adding geom_hline
  if (!is_empty(df_22_omrade_kval)) {
    gg <- gg + geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white")
  }

  gg  # Display the plot

}
```
*Kommunkod: 2313 - Strömsund, 2309 - Krokom, 2321 - Åre, 2380 - Östersund, 2303 - Ragunda, 2305 - Bräcke, 2326 - Berg, 2361 - Härjedalen. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

## Sanering och renhållning

```{r omradeSR_SSYK_kval_22, message=FALSE, warning=FALSE, fig.align = "center"}
## Filter
df_22_omrade_kval <- filter(df, occupation_field.label == "Sanering och renhållning")

df_22_omrade_kval <- df_22_omrade_kval %>%
  group_by(ssyk3_text, ssyk3_code, kvalifikations_niva) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_omrade_kval %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade_kval$total_vac <- as.numeric(df_22_omrade_kval$total_vac)

df_22_omrade_kval <- df_22_omrade_kval %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         kvalifikations_niva = factor(kvalifikations_niva, levels = c("1", "2", "3", "4")))


color_mapping <- c("1" = "#FDE725", "2" = "#35B779", "3" = "#31688E", "4" = "#440154")


ggplot(df_22_omrade_kval, aes(x = ssyk3_text, y = total_vac, fill = factor(kvalifikations_niva, levels = c("4", "3", "2", "1")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Sanering och renhållning, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()
```
*1 - Inga eller låga formella utbildningskrav, 2 - Gymnasie eller eftergymnasial utbildning kortare än 2 år, 3 - Praktiska eller yrkesspecifika eftergymnasiala utbildningar på 2-3 år, 4 - Teoretiska eftergymnasiala utbildningar om minst 3 år. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

```{r omradeSR_SSYK_kommun_22, message=FALSE, warning=FALSE, fig.align = "center"}

## Filter on 22
df_22_omrade <- filter(df, occupation_field.label == "Sanering och renhållning")

df_22_omrade <- df_22_omrade %>%
  group_by(ssyk3_text, workplace_address.municipality_code) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_omrade %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade$total_vac <- as.numeric(df_22_omrade$total_vac)

df_22_omrade <- df_22_omrade %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         workplace_address.municipality_code = factor(workplace_address.municipality_code, 
                                                      levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))

color_mapping <- c("2313" = "#FF7F00", "2309" = "#FDBF6F", "2321" = "#E31A1C", "2380" = "#FB9A99", 
                            "2303" = "#33A02C", "2305" = "#B2DF8A", "2326" = "#1F78B4", "2361" = "#A6CEE3")

ggplot(df_22_omrade, aes(x = ssyk3_text, y = total_vac, fill = factor(workplace_address.municipality_code, levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  #scale_fill_viridis(discrete = TRUE, direction = 1, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Sanering och renhållning, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()


```
*Kommunkod: 2313 - Strömsund, 2309 - Krokom, 2321 - Åre, 2380 - Östersund, 2303 - Ragunda, 2305 - Bräcke, 2326 - Berg, 2361 - Härjedalen. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

## Social inriktning

```{r omradeYS_SSYK_kval_22, message=FALSE, warning=FALSE, fig.align = "center"}

df_22_omrade_kval <- filter(df, occupation_field.label == "Yrken med social inriktning")

df_22_omrade_kval <- df_22_omrade_kval %>%
  group_by(ssyk3_text, ssyk3_code, kvalifikations_niva) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_omrade_kval %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade_kval$total_vac <- as.numeric(df_22_omrade_kval$total_vac)

df_22_omrade_kval <- df_22_omrade_kval %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         kvalifikations_niva = factor(kvalifikations_niva, levels = c("1", "2", "3", "4")))


color_mapping <- c("1" = "#FDE725", "2" = "#35B779", "3" = "#31688E", "4" = "#440154")


ggplot(df_22_omrade_kval, aes(x = ssyk3_text, y = total_vac, fill = factor(kvalifikations_niva, levels = c("4", "3", "2", "1")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Social inriktning, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()
```
*1 - Inga eller låga formella utbildningskrav, 2 - Gymnasie eller eftergymnasial utbildning kortare än 2 år, 3 - Praktiska eller yrkesspecifika eftergymnasiala utbildningar på 2-3 år, 4 - Teoretiska eftergymnasiala utbildningar om minst 3 år. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

```{r omradeYS_SSYK_kommun_22, message=FALSE, warning=FALSE, fig.align = "center"}
library(scales)

## Filter on 22
df_22_omrade <- filter(df, occupation_field.label == "Yrken med social inriktning")

df_22_omrade <- df_22_omrade %>%
  group_by(ssyk3_text, workplace_address.municipality_code) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_omrade %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade$total_vac <- as.numeric(df_22_omrade$total_vac)

df_22_omrade <- df_22_omrade %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         workplace_address.municipality_code = factor(workplace_address.municipality_code, 
                                                      levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))

color_mapping <- c("2313" = "#FF7F00", "2309" = "#FDBF6F", "2321" = "#E31A1C", "2380" = "#FB9A99", 
                            "2303" = "#33A02C", "2305" = "#B2DF8A", "2326" = "#1F78B4", "2361" = "#A6CEE3")

ggplot(df_22_omrade, aes(x = ssyk3_text, y = total_vac, fill = factor(workplace_address.municipality_code, levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  #scale_fill_viridis(discrete = TRUE, direction = 1, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Social inriktning, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()


```
*Kommunkod: 2313 - Strömsund, 2309 - Krokom, 2321 - Åre, 2380 - Östersund, 2303 - Ragunda, 2305 - Bräcke, 2326 - Berg, 2361 - Härjedalen. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

## Säkerhet och bevakning

```{r omradeSB_SSYK_kval_22, message=FALSE, warning=FALSE, fig.align = "center"}
## Filter
df_22_omrade_kval <- filter(df, occupation_field.label == "Säkerhet och bevakning")

df_22_omrade_kval <- df_22_omrade_kval %>%
  group_by(ssyk3_text, ssyk3_code, kvalifikations_niva) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_omrade_kval %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade_kval$total_vac <- as.numeric(df_22_omrade_kval$total_vac)

df_22_omrade_kval <- df_22_omrade_kval %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         kvalifikations_niva = factor(kvalifikations_niva, levels = c("1", "2", "3", "4")))


color_mapping <- c("1" = "#FDE725", "2" = "#35B779", "3" = "#31688E", "4" = "#440154")


ggplot(df_22_omrade_kval, aes(x = ssyk3_text, y = total_vac, fill = factor(kvalifikations_niva, levels = c("4", "3", "2", "1")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Säkerhet och bevakning, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()
```
*1 - Inga eller låga formella utbildningskrav, 2 - Gymnasie eller eftergymnasial utbildning kortare än 2 år, 3 - Praktiska eller yrkesspecifika eftergymnasiala utbildningar på 2-3 år, 4 - Teoretiska eftergymnasiala utbildningar om minst 3 år. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

```{r omradeSB_SSYK_kommun_22, message=FALSE, warning=FALSE, fig.align = "center"}

## Filter on 22
df_22_omrade <- filter(df, occupation_field.label == "Säkerhet och bevakning")

df_22_omrade <- df_22_omrade %>%
  group_by(ssyk3_text, workplace_address.municipality_code) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_omrade %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade$total_vac <- as.numeric(df_22_omrade$total_vac)

df_22_omrade <- df_22_omrade %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         workplace_address.municipality_code = factor(workplace_address.municipality_code, 
                                                      levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))

color_mapping <- c("2313" = "#FF7F00", "2309" = "#FDBF6F", "2321" = "#E31A1C", "2380" = "#FB9A99", 
                            "2303" = "#33A02C", "2305" = "#B2DF8A", "2326" = "#1F78B4", "2361" = "#A6CEE3")

ggplot(df_22_omrade, aes(x = ssyk3_text, y = total_vac, fill = factor(workplace_address.municipality_code, levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  #scale_fill_viridis(discrete = TRUE, direction = 1, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Säkerhet och bevakning, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()


```
*Kommunkod: 2313 - Strömsund, 2309 - Krokom, 2321 - Åre, 2380 - Östersund, 2303 - Ragunda, 2305 - Bräcke, 2326 - Berg, 2361 - Härjedalen. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

## Teknisk inriktning

```{r omradeTI_SSYK_kval_22, message=FALSE, warning=FALSE, fig.align = "center"}
## Filter
df_22_omrade_kval <- filter(df, occupation_field.label == "Yrken med teknisk inriktning")

df_22_omrade_kval <- df_22_omrade_kval %>%
  group_by(ssyk3_text, ssyk3_code, kvalifikations_niva) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_omrade_kval %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade_kval$total_vac <- as.numeric(df_22_omrade_kval$total_vac)

df_22_omrade_kval <- df_22_omrade_kval %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         kvalifikations_niva = factor(kvalifikations_niva, levels = c("1", "2", "3", "4")))


color_mapping <- c("1" = "#FDE725", "2" = "#35B779", "3" = "#31688E", "4" = "#440154")


ggplot(df_22_omrade_kval, aes(x = ssyk3_text, y = total_vac, fill = factor(kvalifikations_niva, levels = c("4", "3", "2", "1")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Teknisk inriktning, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()
```
*1 - Inga eller låga formella utbildningskrav, 2 - Gymnasie eller eftergymnasial utbildning kortare än 2 år, 3 - Praktiska eller yrkesspecifika eftergymnasiala utbildningar på 2-3 år, 4 - Teoretiska eftergymnasiala utbildningar om minst 3 år. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

```{r omradeTI_SSYK_kommun_22, message=FALSE, warning=FALSE, fig.align = "center"}

## Filter on 22
df_22_omrade <- filter(df, occupation_field.label == "Yrken med teknisk inriktning")

df_22_omrade <- df_22_omrade %>%
  group_by(ssyk3_text, workplace_address.municipality_code) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_omrade %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade$total_vac <- as.numeric(df_22_omrade$total_vac)

df_22_omrade <- df_22_omrade %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         workplace_address.municipality_code = factor(workplace_address.municipality_code, 
                                                      levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))

color_mapping <- c("2313" = "#FF7F00", "2309" = "#FDBF6F", "2321" = "#E31A1C", "2380" = "#FB9A99", 
                            "2303" = "#33A02C", "2305" = "#B2DF8A", "2326" = "#1F78B4", "2361" = "#A6CEE3")

ggplot(df_22_omrade, aes(x = ssyk3_text, y = total_vac, fill = factor(workplace_address.municipality_code, levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  #scale_fill_viridis(discrete = TRUE, direction = 1, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Teknisk inriktning, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()


```
*Kommunkod: 2313 - Strömsund, 2309 - Krokom, 2321 - Åre, 2380 - Östersund, 2303 - Ragunda, 2305 - Bräcke, 2326 - Berg, 2361 - Härjedalen. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

## Transport, dist., lager

```{r omradeTDL_SSYK_kval_22, message=FALSE, warning=FALSE, fig.align = "center"}
## Filter
df_22_omrade_kval <- filter(df, occupation_field.label == "Transport, distribution, lager")

df_22_omrade_kval <- df_22_omrade_kval %>%
  group_by(ssyk3_text, ssyk3_code, kvalifikations_niva) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_omrade_kval %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade_kval$total_vac <- as.numeric(df_22_omrade_kval$total_vac)

df_22_omrade_kval <- df_22_omrade_kval %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         kvalifikations_niva = factor(kvalifikations_niva, levels = c("1", "2", "3", "4")))


color_mapping <- c("1" = "#FDE725", "2" = "#35B779", "3" = "#31688E", "4" = "#440154")


ggplot(df_22_omrade_kval, aes(x = ssyk3_text, y = total_vac, fill = factor(kvalifikations_niva, levels = c("4", "3", "2", "1")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Transport, dist., lager, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()
```
*1 - Inga eller låga formella utbildningskrav, 2 - Gymnasie eller eftergymnasial utbildning kortare än 2 år, 3 - Praktiska eller yrkesspecifika eftergymnasiala utbildningar på 2-3 år, 4 - Teoretiska eftergymnasiala utbildningar om minst 3 år. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

```{r omradeTDL_SSYK_kommun_22, message=FALSE, warning=FALSE, fig.align = "center"}

## Filter on 22
df_22_omrade <- filter(df, occupation_field.label == "Transport, distribution, lager")

df_22_omrade <- df_22_omrade %>%
  group_by(ssyk3_text, workplace_address.municipality_code) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_omrade %>%
  group_by(ssyk3_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_omrade$total_vac <- as.numeric(df_22_omrade$total_vac)

df_22_omrade <- df_22_omrade %>%
  mutate(ssyk3_text = forcats::fct_reorder(ssyk3_text, total_vac, .fun = sum),
         workplace_address.municipality_code = factor(workplace_address.municipality_code, 
                                                      levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))

color_mapping <- c("2313" = "#FF7F00", "2309" = "#FDBF6F", "2321" = "#E31A1C", "2380" = "#FB9A99", 
                            "2303" = "#33A02C", "2305" = "#B2DF8A", "2326" = "#1F78B4", "2361" = "#A6CEE3")

ggplot(df_22_omrade, aes(x = ssyk3_text, y = total_vac, fill = factor(workplace_address.municipality_code, levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  #scale_fill_viridis(discrete = TRUE, direction = 1, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Transport, dist., lager, SSYK3 - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()

```
*Kommunkod: 2313 - Strömsund, 2309 - Krokom, 2321 - Åre, 2380 - Östersund, 2303 - Ragunda, 2305 - Bräcke, 2326 - Berg, 2361 - Härjedalen. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>


# Nivå (SSYK1)

```{r platser_ssyk1_22xxfilled, message=FALSE, warning=FALSE, fig.align = "center"}
library(viridis)

df_22_ssyk1 <- df

df_22_ssyk1 <- df_22_ssyk1 %>%
  group_by(ssyk1_text, workplace_address.municipality_code) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_ssyk1 %>%
  group_by(ssyk1_text) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_ssyk1$total_vac <- as.numeric(df_22_ssyk1$total_vac)

df_22_ssyk1 <- df_22_ssyk1 %>%
  mutate(ssyk1_text = forcats::fct_reorder(ssyk1_text, total_vac, .fun = sum),
         workplace_address.municipality_code = factor(workplace_address.municipality_code, 
        levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))


color_mapping <- c("2313" = "#FF7F00", "2309" = "#FDBF6F", "2321" = "#E31A1C", "2380" = "#FB9A99", 
                   "2303" = "#33A02C", "2305" = "#B2DF8A", "2326" = "#1F78B4", "2361" = "#A6CEE3")

ggplot(df_22_ssyk1, aes(x = ssyk1_text, y = total_vac, fill = factor(workplace_address.municipality_code, levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("Yrken efter nivå (SSYK1) - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  coord_flip()
```
*Kommunkod: 2313 - Strömsund, 2309 - Krokom, 2321 - Åre, 2380 - Östersund, 2303 - Ragunda, 2305 - Bräcke, 2326 - Berg, 2361 - Härjedalen. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

## Chefsyrken
```{r platser_ssyk1-1_22xx, message=FALSE, warning=FALSE, fig.align = "center"}
## Filter
df_22_ssyk1_2_omrade <- filter(df, ssyk1_code == 1)

df_22_ssyk1_2_omrade <- df_22_ssyk1_2_omrade %>%
  group_by(occupation_field.label, workplace_address.municipality_code) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_ssyk1_2_omrade %>%
  group_by(occupation_field.label) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_ssyk1_2_omrade$total_vac <- as.numeric(df_22_ssyk1_2_omrade$total_vac)

df_22_ssyk1_2_omrade <- df_22_ssyk1_2_omrade %>%
  mutate(occupation_field.label = forcats::fct_reorder(occupation_field.label, total_vac, .fun = sum),
         workplace_address.municipality_code = factor(workplace_address.municipality_code, 
        levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))

color_mapping <- c("2313" = "#FF7F00", "2309" = "#FDBF6F", "2321" = "#E31A1C", "2380" = "#FB9A99", 
                   "2303" = "#33A02C", "2305" = "#B2DF8A", "2326" = "#1F78B4", "2361" = "#A6CEE3")

ggplot(df_22_ssyk1_2_omrade, aes(x = occupation_field.label, y = total_vac, fill = factor(workplace_address.municipality_code, levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("SSYK1-1 och yrkesområde - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  coord_flip()
```
*Kommunkod: 2313 - Strömsund, 2309 - Krokom, 2321 - Åre, 2380 - Östersund, 2303 - Ragunda, 2305 - Bräcke, 2326 - Berg, 2361 - Härjedalen. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

```{r platser_ssyk1-1_TAB, message=FALSE, warning=FALSE, fig.align = "center"}
library(flextable)

## Filter
df_22_omrade_ssyk1_2_Tssyk3 <- filter(df, ssyk1_code == 1)

## Group and create var.
df_22_omrade_ssyk1_2_Tssyk3 <- df_22_omrade_ssyk1_2_Tssyk3 %>%
  group_by(occupation_field.label, ssyk3_code, ssyk3_text) %>%
  summarize(Totalt = sum(number_of_vacancies, na.rm = TRUE),
            "Varav behovs." = sum(number_of_vacancies[employment_type.label == "Behovsanställning"], na.rm = TRUE),
                      "Varav ferie" = sum(number_of_vacancies[employment_type.label == "Sommarjobb / feriejobb"], na.rm = TRUE)) %>%
  ungroup()

## Rename col. for table
df_22_omrade_ssyk1_2_Tssyk3 <- df_22_omrade_ssyk1_2_Tssyk3 %>%
  rename("Område (Af)" = occupation_field.label) %>%
  rename("SSYK3 - kod" = ssyk3_code) %>%
  rename("SSYK3 - text" = ssyk3_text)

## Fixa ordning enl. total_vac
df_22_omrade_ssyk1_2_Tssyk3 <- arrange(df_22_omrade_ssyk1_2_Tssyk3, desc(Totalt))

ft <- flextable(df_22_omrade_ssyk1_2_Tssyk3)
ft <- set_caption(ft, caption =sprintf("Tabell 8. Antal tjänster utifrån SSYK1-1 (chefsyrken), redovisat per yrkesområde (Af) och SSYK3-nivå - %s", geografi), align_with_table = F)
#ft <- add_header_row(ft, colwidths = c(1,2,4,3), values = c("","Arbetskraften","Ej i arbetskraften","Nyckeltal"))
ft <- colformat_num(x = ft,
                    big.mark=" ", decimal.mark = ",",
                    na_str = "N/A")
ft <- theme_vanilla(ft)
#ft <- align(ft, i = 1, j=NULL, align = "center", part = "header")
ft
```
Källa: Af och bearbetningar av Region Västernorrland

<br>

## Fördjupad högskolekompetens

```{r platser_ssyk1-2_22xxfilled, message=FALSE, warning=FALSE, fig.align = "center"}
## Filter
df_22_ssyk1_2_omrade <- filter(df, ssyk1_code == 2)

df_22_ssyk1_2_omrade <- df_22_ssyk1_2_omrade %>%
  group_by(occupation_field.label, workplace_address.municipality_code) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_ssyk1_2_omrade %>%
  group_by(occupation_field.label) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_ssyk1_2_omrade$total_vac <- as.numeric(df_22_ssyk1_2_omrade$total_vac)

df_22_ssyk1_2_omrade <- df_22_ssyk1_2_omrade %>%
  mutate(occupation_field.label = forcats::fct_reorder(occupation_field.label, total_vac, .fun = sum),
         workplace_address.municipality_code = factor(workplace_address.municipality_code, 
                                                      levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))

color_mapping <- c("2313" = "#FF7F00", "2309" = "#FDBF6F", "2321" = "#E31A1C", "2380" = "#FB9A99", 
                   "2303" = "#33A02C", "2305" = "#B2DF8A", "2326" = "#1F78B4", "2361" = "#A6CEE3")

ggplot(df_22_ssyk1_2_omrade, aes(x = occupation_field.label, y = total_vac, fill = factor(workplace_address.municipality_code, levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("SSYK1-2 och yrkesområde - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  coord_flip()
```
*Kommunkod: 2313 - Strömsund, 2309 - Krokom, 2321 - Åre, 2380 - Östersund, 2303 - Ragunda, 2305 - Bräcke, 2326 - Berg, 2361 - Härjedalen. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

```{r platser_ssyk1-2_TAB, message=FALSE, warning=FALSE, fig.align = "center"}
library(flextable)

## Filter
df_22_omrade_ssyk1_2_Tssyk3 <- filter(df, ssyk1_code == 2)

## Group and create var.
df_22_omrade_ssyk1_2_Tssyk3 <- df_22_omrade_ssyk1_2_Tssyk3 %>%
  group_by(occupation_field.label, ssyk3_code, ssyk3_text) %>%
  summarize(Totalt = sum(number_of_vacancies, na.rm = TRUE),
            "Varav behovs." = sum(number_of_vacancies[employment_type.label == "Behovsanställning"], na.rm = TRUE),
                      "Varav ferie" = sum(number_of_vacancies[employment_type.label == "Sommarjobb / feriejobb"], na.rm = TRUE)) %>%
  ungroup()

## Rename col. for table
df_22_omrade_ssyk1_2_Tssyk3 <- df_22_omrade_ssyk1_2_Tssyk3 %>%
  rename("Område (Af)" = occupation_field.label) %>%
  rename("SSYK3 - kod" = ssyk3_code) %>%
  rename("SSYK3 - text" = ssyk3_text)

## Fixa ordning enl. total_vac
df_22_omrade_ssyk1_2_Tssyk3 <- arrange(df_22_omrade_ssyk1_2_Tssyk3, desc(Totalt))

ft <- flextable(df_22_omrade_ssyk1_2_Tssyk3)
ft <- set_caption(ft, caption =sprintf("Tabell 1. Antal tjänster utifrån SSYK1-2 (yrken med krav på fördjupad högskolekompetens), redovisat per yrkesområde (Af) och SSYK3-nivå - %s", geografi), align_with_table = F)
#ft <- add_header_row(ft, colwidths = c(1,2,4,3), values = c("","Arbetskraften","Ej i arbetskraften","Nyckeltal"))
ft <- colformat_num(x = ft,
                    big.mark=" ", decimal.mark = ",",
                    na_str = "N/A")
ft <- theme_vanilla(ft)
#ft <- align(ft, i = 1, j=NULL, align = "center", part = "header")
ft
```
Källa: Af och bearbetningar av Region Västernorrland

<br>

## Högskolekompetens eller motsvarande
```{r platser_ssyk1-3_22xx, message=FALSE, warning=FALSE, fig.align = "center"}
## Filter
df_22_ssyk1_2_omrade <- filter(df, ssyk1_code == 3)

df_22_ssyk1_2_omrade <- df_22_ssyk1_2_omrade %>%
  group_by(occupation_field.label, workplace_address.municipality_code) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_ssyk1_2_omrade %>%
  group_by(occupation_field.label) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_ssyk1_2_omrade$total_vac <- as.numeric(df_22_ssyk1_2_omrade$total_vac)

df_22_ssyk1_2_omrade <- df_22_ssyk1_2_omrade %>%
  mutate(occupation_field.label = forcats::fct_reorder(occupation_field.label, total_vac, .fun = sum),
         workplace_address.municipality_code = factor(workplace_address.municipality_code, 
                                                      levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))

color_mapping <- c("2313" = "#FF7F00", "2309" = "#FDBF6F", "2321" = "#E31A1C", "2380" = "#FB9A99", 
                   "2303" = "#33A02C", "2305" = "#B2DF8A", "2326" = "#1F78B4", "2361" = "#A6CEE3")

ggplot(df_22_ssyk1_2_omrade, aes(x = occupation_field.label, y = total_vac, fill = factor(workplace_address.municipality_code, levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("SSYK1-3 och yrkesområde - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  coord_flip()
```
*Kommunkod: 2313 - Strömsund, 2309 - Krokom, 2321 - Åre, 2380 - Östersund, 2303 - Ragunda, 2305 - Bräcke, 2326 - Berg, 2361 - Härjedalen. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

```{r platser_ssyk1-3_TAB, message=FALSE, warning=FALSE, fig.align = "center"}
library(flextable)

## Filter
df_22_omrade_ssyk1_2_Tssyk3 <- filter(df, ssyk1_code == 3)

## Group and create var.
df_22_omrade_ssyk1_2_Tssyk3 <- df_22_omrade_ssyk1_2_Tssyk3 %>%
  group_by(occupation_field.label, ssyk3_code, ssyk3_text) %>%
  summarize(Totalt = sum(number_of_vacancies, na.rm = TRUE),
            "Varav behovs." = sum(number_of_vacancies[employment_type.label == "Behovsanställning"], na.rm = TRUE),
                      "Varav ferie" = sum(number_of_vacancies[employment_type.label == "Sommarjobb / feriejobb"], na.rm = TRUE)) %>%
  ungroup()

## Rename col. for table
df_22_omrade_ssyk1_2_Tssyk3 <- df_22_omrade_ssyk1_2_Tssyk3 %>%
  rename("Område (Af)" = occupation_field.label) %>%
  rename("SSYK3 - kod" = ssyk3_code) %>%
  rename("SSYK3 - text" = ssyk3_text)

## Fixa ordning enl. total_vac
df_22_omrade_ssyk1_2_Tssyk3 <- arrange(df_22_omrade_ssyk1_2_Tssyk3, desc(Totalt))

ft <- flextable(df_22_omrade_ssyk1_2_Tssyk3)
ft <- set_caption(ft, caption =sprintf("Tabell 3. Antal tjänster utifrån SSYK1-3 (yrken med krav på högskolekompetens eller motsvarande), redovisat per yrkesområde (Af) och SSYK3-nivå - %s", geografi), align_with_table = F)
#ft <- add_header_row(ft, colwidths = c(1,2,4,3), values = c("","Arbetskraften","Ej i arbetskraften","Nyckeltal"))
ft <- colformat_num(x = ft,
                    big.mark=" ", decimal.mark = ",",
                    na_str = "N/A")
ft <- theme_vanilla(ft)
#ft <- align(ft, i = 1, j=NULL, align = "center", part = "header")
ft
```
Källa: Af och bearbetningar av Region Västernorrland

<br>

## Admin. och kundtjänst
```{r platser_ssyk1-4_22xx, message=FALSE, warning=FALSE, fig.align = "center"}
## Filter on 22
df_22_ssyk1_2_omrade <- filter(df, ssyk1_code == 4)

df_22_ssyk1_2_omrade <- df_22_ssyk1_2_omrade %>%
  group_by(occupation_field.label, workplace_address.municipality_code) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_ssyk1_2_omrade %>%
  group_by(occupation_field.label) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_ssyk1_2_omrade$total_vac <- as.numeric(df_22_ssyk1_2_omrade$total_vac)

df_22_ssyk1_2_omrade <- df_22_ssyk1_2_omrade %>%
  mutate(occupation_field.label = forcats::fct_reorder(occupation_field.label, total_vac, .fun = sum),
         workplace_address.municipality_code = factor(workplace_address.municipality_code, 
                                                      levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))

color_mapping <- c("2313" = "#FF7F00", "2309" = "#FDBF6F", "2321" = "#E31A1C", "2380" = "#FB9A99", 
                   "2303" = "#33A02C", "2305" = "#B2DF8A", "2326" = "#1F78B4", "2361" = "#A6CEE3")

ggplot(df_22_ssyk1_2_omrade, aes(x = occupation_field.label, y = total_vac, fill = factor(workplace_address.municipality_code, levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("SSYK1-4 och yrkesområde - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  coord_flip()
```
*Kommunkod: 2313 - Strömsund, 2309 - Krokom, 2321 - Åre, 2380 - Östersund, 2303 - Ragunda, 2305 - Bräcke, 2326 - Berg, 2361 - Härjedalen. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

```{r platser_ssyk1-4_TAB, message=FALSE, warning=FALSE, fig.align = "center"}
library(flextable)

## Filter
df_22_omrade_ssyk1_2_Tssyk3 <- filter(df, ssyk1_code == 4)

## Group and create var.
df_22_omrade_ssyk1_2_Tssyk3 <- df_22_omrade_ssyk1_2_Tssyk3 %>%
  group_by(occupation_field.label, ssyk3_code, ssyk3_text) %>%
  summarize(Totalt = sum(number_of_vacancies, na.rm = TRUE),
            "Varav behovs." = sum(number_of_vacancies[employment_type.label == "Behovsanställning"], na.rm = TRUE),
                      "Varav ferie" = sum(number_of_vacancies[employment_type.label == "Sommarjobb / feriejobb"], na.rm = TRUE)) %>%
  ungroup()

## Rename col. for table
df_22_omrade_ssyk1_2_Tssyk3 <- df_22_omrade_ssyk1_2_Tssyk3 %>%
  rename("Område (Af)" = occupation_field.label) %>%
  rename("SSYK3 - kod" = ssyk3_code) %>%
  rename("SSYK3 - text" = ssyk3_text)

## Fixa ordning enl. total_vac
df_22_omrade_ssyk1_2_Tssyk3 <- arrange(df_22_omrade_ssyk1_2_Tssyk3, desc(Totalt))

ft <- flextable(df_22_omrade_ssyk1_2_Tssyk3)
ft <- set_caption(ft, caption =sprintf("Tabell 5. Antal tjänster utifrån SSYK1-4 (yrken inom administration och kundtjänst), redovisat per yrkesområde (Af) och SSYK3-nivå - %s", geografi), align_with_table = F)
#ft <- add_header_row(ft, colwidths = c(1,2,4,3), values = c("","Arbetskraften","Ej i arbetskraften","Nyckeltal"))
ft <- colformat_num(x = ft,
                    big.mark=" ", decimal.mark = ",",
                    na_str = "N/A")
ft <- theme_vanilla(ft)
#ft <- align(ft, i = 1, j=NULL, align = "center", part = "header")
ft
```
Källa: Af och bearbetningar av Region Västernorrland

<br>

## Service-, omsorg- och frsj.
```{r platser_ssyk1-5_22xx, message=FALSE, warning=FALSE, fig.align = "center"}
## Filter
df_22_ssyk1_2_omrade <- filter(df, ssyk1_code == 5)

df_22_ssyk1_2_omrade <- df_22_ssyk1_2_omrade %>%
  group_by(occupation_field.label, workplace_address.municipality_code) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_ssyk1_2_omrade %>%
  group_by(occupation_field.label) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_ssyk1_2_omrade$total_vac <- as.numeric(df_22_ssyk1_2_omrade$total_vac)

df_22_ssyk1_2_omrade <- df_22_ssyk1_2_omrade %>%
  mutate(occupation_field.label = forcats::fct_reorder(occupation_field.label, total_vac, .fun = sum),
         workplace_address.municipality_code = factor(workplace_address.municipality_code, 
                                                      levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))

color_mapping <- c("2313" = "#FF7F00", "2309" = "#FDBF6F", "2321" = "#E31A1C", "2380" = "#FB9A99", 
                   "2303" = "#33A02C", "2305" = "#B2DF8A", "2326" = "#1F78B4", "2361" = "#A6CEE3")

ggplot(df_22_ssyk1_2_omrade, aes(x = occupation_field.label, y = total_vac, fill = factor(workplace_address.municipality_code, levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("SSYK1-5 och yrkesområde - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  coord_flip()
```
*Kommunkod: 2313 - Strömsund, 2309 - Krokom, 2321 - Åre, 2380 - Östersund, 2303 - Ragunda, 2305 - Bräcke, 2326 - Berg, 2361 - Härjedalen. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

```{r platser_ssyk1-5_TAB, message=FALSE, warning=FALSE, fig.align = "center"}
library(flextable)

## Filter
df_22_omrade_ssyk1_2_Tssyk3 <- filter(df, ssyk1_code == 5)

## Group and create var.
df_22_omrade_ssyk1_2_Tssyk3 <- df_22_omrade_ssyk1_2_Tssyk3 %>%
  group_by(occupation_field.label, ssyk3_code, ssyk3_text) %>%
  summarize(Totalt = sum(number_of_vacancies, na.rm = TRUE),
            "Varav behovs." = sum(number_of_vacancies[employment_type.label == "Behovsanställning"], na.rm = TRUE),
                      "Varav ferie" = sum(number_of_vacancies[employment_type.label == "Sommarjobb / feriejobb"], na.rm = TRUE)) %>%
  ungroup()

## Rename col. for table
df_22_omrade_ssyk1_2_Tssyk3 <- df_22_omrade_ssyk1_2_Tssyk3 %>%
  rename("Område (Af)" = occupation_field.label) %>%
  rename("SSYK3 - kod" = ssyk3_code) %>%
  rename("SSYK3 - text" = ssyk3_text)

## Fixa ordning enl. total_vac
df_22_omrade_ssyk1_2_Tssyk3 <- arrange(df_22_omrade_ssyk1_2_Tssyk3, desc(Totalt))

ft <- flextable(df_22_omrade_ssyk1_2_Tssyk3)
ft <- set_caption(ft, caption =sprintf("Tabell 2. Antal tjänster utifrån SSYK1-5 (service-, omsorgs- och försäljningsyrken), redovisat per yrkesområde (Af) och SSYK3-nivå - %s", geografi), align_with_table = F)
#ft <- add_header_row(ft, colwidths = c(1,2,4,3), values = c("","Arbetskraften","Ej i arbetskraften","Nyckeltal"))
ft <- colformat_num(x = ft,
                    big.mark=" ", decimal.mark = ",",
                    na_str = "N/A")
ft <- theme_vanilla(ft)
#ft <- align(ft, i = 1, j=NULL, align = "center", part = "header")
ft
```
Källa: Af och bearbetningar av Region Västernorrland

<br>

## Lantbruk, trädgård, skog och fiske
```{r platser_ssyk1-6_22xx, message=FALSE, warning=FALSE, fig.align = "center"}
library(scales)

## Filter
df_22_ssyk1_2_omrade <- filter(df, ssyk1_code == 6)

# Check if df_22_omrade_kval is empty
if (nrow(df_22_ssyk1_2_omrade) == 0) {
  message("The dataframe is empty. Skipping this chunk.")
  knitr::opts_chunk$set(error = FALSE)  # Stop chunk execution here
} else {

df_22_ssyk1_2_omrade <- df_22_ssyk1_2_omrade %>%
  group_by(occupation_field.label, workplace_address.municipality_code) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_ssyk1_2_omrade %>%
  group_by(occupation_field.label) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_ssyk1_2_omrade$total_vac <- as.numeric(df_22_ssyk1_2_omrade$total_vac)

df_22_ssyk1_2_omrade <- df_22_ssyk1_2_omrade %>%
  mutate(occupation_field.label = forcats::fct_reorder(occupation_field.label, total_vac, .fun = sum),
         workplace_address.municipality_code = factor(workplace_address.municipality_code, 
                                                      levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))

color_mapping <- c("2313" = "#FF7F00", "2309" = "#FDBF6F", "2321" = "#E31A1C", "2380" = "#FB9A99", 
                   "2303" = "#33A02C", "2305" = "#B2DF8A", "2326" = "#1F78B4", "2361" = "#A6CEE3")

gg<-ggplot(df_22_ssyk1_2_omrade, aes(x = occupation_field.label, y = total_vac, fill = factor(workplace_address.municipality_code, levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("SSYK1-6 och yrkesområde - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()

  # Check if df_22_omrade_kval is not empty before adding geom_hline
  if (!is_empty(df_22_ssyk1_2_omrade)) {
    gg <- gg + geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white")
  }

  gg  # Display the plot

}
```
*Kommunkod: 2313 - Strömsund, 2309 - Krokom, 2321 - Åre, 2380 - Östersund, 2303 - Ragunda, 2305 - Bräcke, 2326 - Berg, 2361 - Härjedalen. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

```{r platser_ssyk1-6_TAB, message=FALSE, warning=FALSE, fig.align = "center"}
library(flextable)

## Filter
df_22_omrade_ssyk1_2_Tssyk3 <- filter(df, ssyk1_code == 6)

## Group and create var.
df_22_omrade_ssyk1_2_Tssyk3 <- df_22_omrade_ssyk1_2_Tssyk3 %>%
  group_by(occupation_field.label, ssyk3_code, ssyk3_text) %>%
  summarize(Totalt = sum(number_of_vacancies, na.rm = TRUE),
            "Varav behovs." = sum(number_of_vacancies[employment_type.label == "Behovsanställning"], na.rm = TRUE),
                      "Varav ferie" = sum(number_of_vacancies[employment_type.label == "Sommarjobb / feriejobb"], na.rm = TRUE)) %>%
  ungroup()

## Rename col. for table
df_22_omrade_ssyk1_2_Tssyk3 <- df_22_omrade_ssyk1_2_Tssyk3 %>%
  rename("Område (Af)" = occupation_field.label) %>%
  rename("SSYK3 - kod" = ssyk3_code) %>%
  rename("SSYK3 - text" = ssyk3_text)

## Fixa ordning enl. total_vac
df_22_omrade_ssyk1_2_Tssyk3 <- arrange(df_22_omrade_ssyk1_2_Tssyk3, desc(Totalt))

ft <- flextable(df_22_omrade_ssyk1_2_Tssyk3)
ft <- set_caption(ft, caption =sprintf("Tabell 9. Antal tjänster utifrån SSYK1-6 (yrken inom lantbruk, trädgård, skogsbruk och fiske), redovisat per yrkesområde (Af) och SSYK3-nivå - %s", geografi), align_with_table = F)
#ft <- add_header_row(ft, colwidths = c(1,2,4,3), values = c("","Arbetskraften","Ej i arbetskraften","Nyckeltal"))
ft <- colformat_num(x = ft,
                    big.mark=" ", decimal.mark = ",",
                    na_str = "N/A")
ft <- theme_vanilla(ft)
#ft <- align(ft, i = 1, j=NULL, align = "center", part = "header")
ft
```
Källa: Af och bearbetningar av Region Västernorrland

<br>

## Bygg och tillverkning
```{r platser_ssyk1-7_22xx, message=FALSE, warning=FALSE, fig.align = "center"}
## Filter on 22
df_22_ssyk1_2_omrade <- filter(df, ssyk1_code == 7)

df_22_ssyk1_2_omrade <- df_22_ssyk1_2_omrade %>%
  group_by(occupation_field.label, workplace_address.municipality_code) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_ssyk1_2_omrade %>%
  group_by(occupation_field.label) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_ssyk1_2_omrade$total_vac <- as.numeric(df_22_ssyk1_2_omrade$total_vac)

df_22_ssyk1_2_omrade <- df_22_ssyk1_2_omrade %>%
  mutate(occupation_field.label = forcats::fct_reorder(occupation_field.label, total_vac, .fun = sum),
         workplace_address.municipality_code = factor(workplace_address.municipality_code, 
                                                      levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))

color_mapping <- c("2313" = "#FF7F00", "2309" = "#FDBF6F", "2321" = "#E31A1C", "2380" = "#FB9A99", 
                   "2303" = "#33A02C", "2305" = "#B2DF8A", "2326" = "#1F78B4", "2361" = "#A6CEE3")

ggplot(df_22_ssyk1_2_omrade, aes(x = occupation_field.label, y = total_vac, fill = factor(workplace_address.municipality_code, levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("SSYK1-7 och yrkesområde - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  coord_flip()
```
*Kommunkod: 2313 - Strömsund, 2309 - Krokom, 2321 - Åre, 2380 - Östersund, 2303 - Ragunda, 2305 - Bräcke, 2326 - Berg, 2361 - Härjedalen. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

```{r platser_ssyk1-7_TAB, message=FALSE, warning=FALSE, fig.align = "center"}
library(flextable)

## Filter
df_22_omrade_ssyk1_2_Tssyk3 <- filter(df, ssyk1_code == 7)

## Group and create var.
df_22_omrade_ssyk1_2_Tssyk3 <- df_22_omrade_ssyk1_2_Tssyk3 %>%
  group_by(occupation_field.label, ssyk3_code, ssyk3_text) %>%
  summarize(Totalt = sum(number_of_vacancies, na.rm = TRUE),
            "Varav behovs." = sum(number_of_vacancies[employment_type.label == "Behovsanställning"], na.rm = TRUE),
                      "Varav ferie" = sum(number_of_vacancies[employment_type.label == "Sommarjobb / feriejobb"], na.rm = TRUE)) %>%
  ungroup()

## Rename col. for table
df_22_omrade_ssyk1_2_Tssyk3 <- df_22_omrade_ssyk1_2_Tssyk3 %>%
  rename("Område (Af)" = occupation_field.label) %>%
  rename("SSYK3 - kod" = ssyk3_code) %>%
  rename("SSYK3 - text" = ssyk3_text)

## Fixa ordning enl. total_vac
df_22_omrade_ssyk1_2_Tssyk3 <- arrange(df_22_omrade_ssyk1_2_Tssyk3, desc(Totalt))

ft <- flextable(df_22_omrade_ssyk1_2_Tssyk3)
ft <- set_caption(ft, caption =sprintf("Tabell 4. Antal tjänster utifrån SSYK1-3 (yrken inom byggverksamhet och tillverkning), redovisat per yrkesområde (Af) och SSYK3-nivå - %s", geografi), align_with_table = F)
#ft <- add_header_row(ft, colwidths = c(1,2,4,3), values = c("","Arbetskraften","Ej i arbetskraften","Nyckeltal"))
ft <- colformat_num(x = ft,
                    big.mark=" ", decimal.mark = ",",
                    na_str = "N/A")
ft <- theme_vanilla(ft)
#ft <- align(ft, i = 1, j=NULL, align = "center", part = "header")
ft
```
Källa: Af och bearbetningar av Region Västernorrland

<br>

## Maskinell tillv. och transport m.m.
```{r platser_ssyk1-8_22xx, message=FALSE, warning=FALSE, fig.align = "center"}
## Filter
df_22_ssyk1_2_omrade <- filter(df, ssyk1_code == 8)

df_22_ssyk1_2_omrade <- df_22_ssyk1_2_omrade %>%
  group_by(occupation_field.label, workplace_address.municipality_code) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_ssyk1_2_omrade %>%
  group_by(occupation_field.label) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_ssyk1_2_omrade$total_vac <- as.numeric(df_22_ssyk1_2_omrade$total_vac)

df_22_ssyk1_2_omrade <- df_22_ssyk1_2_omrade %>%
  mutate(occupation_field.label = forcats::fct_reorder(occupation_field.label, total_vac, .fun = sum),
         workplace_address.municipality_code = factor(workplace_address.municipality_code, 
                                                      levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))

color_mapping <- c("2313" = "#FF7F00", "2309" = "#FDBF6F", "2321" = "#E31A1C", "2380" = "#FB9A99", 
                   "2303" = "#33A02C", "2305" = "#B2DF8A", "2326" = "#1F78B4", "2361" = "#A6CEE3")

ggplot(df_22_ssyk1_2_omrade, aes(x = occupation_field.label, y = total_vac, fill = factor(workplace_address.municipality_code, levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("SSYK1-8 och yrkesområde - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  coord_flip()
```
*Kommunkod: 2313 - Strömsund, 2309 - Krokom, 2321 - Åre, 2380 - Östersund, 2303 - Ragunda, 2305 - Bräcke, 2326 - Berg, 2361 - Härjedalen. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

```{r platser_ssyk1-8_TAB, message=FALSE, warning=FALSE, fig.align = "center"}
library(flextable)

## Filter
df_22_omrade_ssyk1_2_Tssyk3 <- filter(df, ssyk1_code == 8)

## Group and create var.
df_22_omrade_ssyk1_2_Tssyk3 <- df_22_omrade_ssyk1_2_Tssyk3 %>%
  group_by(occupation_field.label, ssyk3_code, ssyk3_text) %>%
  summarize(Totalt = sum(number_of_vacancies, na.rm = TRUE),
            "Varav behovs." = sum(number_of_vacancies[employment_type.label == "Behovsanställning"], na.rm = TRUE),
                      "Varav ferie" = sum(number_of_vacancies[employment_type.label == "Sommarjobb / feriejobb"], na.rm = TRUE)) %>%
  ungroup()

## Rename col. for table
df_22_omrade_ssyk1_2_Tssyk3 <- df_22_omrade_ssyk1_2_Tssyk3 %>%
  rename("Område (Af)" = occupation_field.label) %>%
  rename("SSYK3 - kod" = ssyk3_code) %>%
  rename("SSYK3 - text" = ssyk3_text)

## Fixa ordning enl. total_vac
df_22_omrade_ssyk1_2_Tssyk3 <- arrange(df_22_omrade_ssyk1_2_Tssyk3, desc(Totalt))

ft <- flextable(df_22_omrade_ssyk1_2_Tssyk3)
ft <- set_caption(ft, caption =sprintf("Tabell 7. Antal tjänster utifrån SSYK1-8 (yrken inom maskinell tillverkning och transport m.m.), redovisat per yrkesområde (Af) och SSYK3-nivå - %s", geografi), align_with_table = F)
#ft <- add_header_row(ft, colwidths = c(1,2,4,3), values = c("","Arbetskraften","Ej i arbetskraften","Nyckeltal"))
ft <- colformat_num(x = ft,
                    big.mark=" ", decimal.mark = ",",
                    na_str = "N/A")
ft <- theme_vanilla(ft)
#ft <- align(ft, i = 1, j=NULL, align = "center", part = "header")
ft
```
Källa: Af och bearbetningar av Region Västernorrland

<br>

## Kortare utb.
```{r platser_ssyk1-9_22xx, message=FALSE, warning=FALSE, fig.align = "center"}
## Filter
df_22_ssyk1_2_omrade <- filter(df, ssyk1_code == 9)

df_22_ssyk1_2_omrade <- df_22_ssyk1_2_omrade %>%
  group_by(occupation_field.label, workplace_address.municipality_code) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_ssyk1_2_omrade %>%
  group_by(occupation_field.label) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_ssyk1_2_omrade$total_vac <- as.numeric(df_22_ssyk1_2_omrade$total_vac)

df_22_ssyk1_2_omrade <- df_22_ssyk1_2_omrade %>%
  mutate(occupation_field.label = forcats::fct_reorder(occupation_field.label, total_vac, .fun = sum),
         workplace_address.municipality_code = factor(workplace_address.municipality_code, 
                                                      levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))

color_mapping <- c("2313" = "#FF7F00", "2309" = "#FDBF6F", "2321" = "#E31A1C", "2380" = "#FB9A99", 
                   "2303" = "#33A02C", "2305" = "#B2DF8A", "2326" = "#1F78B4", "2361" = "#A6CEE3")

ggplot(df_22_ssyk1_2_omrade, aes(x = occupation_field.label, y = total_vac, fill = factor(workplace_address.municipality_code, levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white") +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("SSYK1-9 och yrkesområde - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  coord_flip()
```
*Kommunkod: 2313 - Strömsund, 2309 - Krokom, 2321 - Åre, 2380 - Östersund, 2303 - Ragunda, 2305 - Bräcke, 2326 - Berg, 2361 - Härjedalen. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

```{r platser_ssyk1-9_TAB, message=FALSE, warning=FALSE, fig.align = "center"}
library(flextable)

## Filter
df_22_omrade_ssyk1_2_Tssyk3 <- filter(df, ssyk1_code == 9)

## Group and create var.
df_22_omrade_ssyk1_2_Tssyk3 <- df_22_omrade_ssyk1_2_Tssyk3 %>%
  group_by(occupation_field.label, ssyk3_code, ssyk3_text) %>%
  summarize(Totalt = sum(number_of_vacancies, na.rm = TRUE),
            "Varav behovs." = sum(number_of_vacancies[employment_type.label == "Behovsanställning"], na.rm = TRUE),
                      "Varav ferie" = sum(number_of_vacancies[employment_type.label == "Sommarjobb / feriejobb"], na.rm = TRUE)) %>%
  ungroup()

## Rename col. for table
df_22_omrade_ssyk1_2_Tssyk3 <- df_22_omrade_ssyk1_2_Tssyk3 %>%
  rename("Område (Af)" = occupation_field.label) %>%
  rename("SSYK3 - kod" = ssyk3_code) %>%
  rename("SSYK3 - text" = ssyk3_text)

## Fixa ordning enl. total_vac
df_22_omrade_ssyk1_2_Tssyk3 <- arrange(df_22_omrade_ssyk1_2_Tssyk3, desc(Totalt))

ft <- flextable(df_22_omrade_ssyk1_2_Tssyk3)
ft <- set_caption(ft, caption =sprintf("Tabell 6. Antal tjänster utifrån SSYK1-9 (yrken med krav på kortare utbildning eller introduktion), redovisat per yrkesområde (Af) och SSYK3-nivå - %s", geografi), align_with_table = F)
#ft <- add_header_row(ft, colwidths = c(1,2,4,3), values = c("","Arbetskraften","Ej i arbetskraften","Nyckeltal"))
ft <- colformat_num(x = ft,
                    big.mark=" ", decimal.mark = ",",
                    na_str = "N/A")
ft <- theme_vanilla(ft)
#ft <- align(ft, i = 1, j=NULL, align = "center", part = "header")
ft
```
Källa: Af och bearbetningar av Region Västernorrland

<br>

## Militära yrken
```{r platser_ssyk1-0_22xx, message=FALSE, warning=FALSE, fig.align = "center"}
## Filter
df_22_ssyk1_2_omrade <- filter(df, ssyk1_code == 0)

# Check if df_22_omrade_kval is empty
if (nrow(df_22_ssyk1_2_omrade) == 0) {
  message("The dataframe is empty. Skipping this chunk.")
  knitr::opts_chunk$set(error = FALSE)  # Stop chunk execution here
} else {
df_22_ssyk1_2_omrade <- df_22_ssyk1_2_omrade %>%
  group_by(occupation_field.label, workplace_address.municipality_code) %>%
  summarize(total_vac = sum(number_of_vacancies, na.rm = TRUE)) %>%
  ungroup()

max_value <- df_22_ssyk1_2_omrade %>%
  group_by(occupation_field.label) %>%
  summarize(total_vac_sum = sum(total_vac)) %>%
  arrange(desc(total_vac_sum)) %>%
  slice(1) %>%
  pull(total_vac_sum)


df_22_ssyk1_2_omrade$total_vac <- as.numeric(df_22_ssyk1_2_omrade$total_vac)

df_22_ssyk1_2_omrade <- df_22_ssyk1_2_omrade %>%
  mutate(occupation_field.label = forcats::fct_reorder(occupation_field.label, total_vac, .fun = sum),
         workplace_address.municipality_code = factor(workplace_address.municipality_code, 
                                                      levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))

color_mapping <- c("2313" = "#FF7F00", "2309" = "#FDBF6F", "2321" = "#E31A1C", "2380" = "#FB9A99", 
                   "2303" = "#33A02C", "2305" = "#B2DF8A", "2326" = "#1F78B4", "2361" = "#A6CEE3")

gg<-ggplot(df_22_ssyk1_2_omrade, aes(x = occupation_field.label, y = total_vac, fill = factor(workplace_address.municipality_code, levels = c("2361", "2326", "2305", "2303", "2380","2321","2309","2313")))) +
  geom_col() +
  scale_fill_manual(values=color_mapping, guide = guide_legend(reverse = TRUE)) +
  theme_tufte() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        legend.title = element_blank(),
        legend.position = "bottom",
        axis.ticks.x = element_blank()) +
  labs(title = "Lediga tjänster",
       subtitle = sprintf("SSYK1-0 och yrkesområde - %s", geografi),
       y = "Tjänster",
       x = "",
       caption = "Källa: Af och bearbetningar av Region Västernorrland") +
  scale_y_continuous(labels = number_format(accuracy = 1))+
  coord_flip()

  # Check if df_22_omrade_kval is not empty before adding geom_hline
  if (!is_empty(df_22_ssyk1_2_omrade)) {
    gg <- gg + geom_hline(yintercept = seq(from = 0, to = max_value, by = 50), color = "white")
  }

  gg  # Display the plot

}
```
*Kommunkod: 2313 - Strömsund, 2309 - Krokom, 2321 - Åre, 2380 - Östersund, 2303 - Ragunda, 2305 - Bräcke, 2326 - Berg, 2361 - Härjedalen. För att underlätta läsning av diagrammet har 'klossar' införts - varje kloss motsvarar 50 tjänster.*

<br>

```{r platser_ssyk1-0_TAB, message=FALSE, warning=FALSE, fig.align = "center"}
library(flextable)
## Filter
df_22_omrade_ssyk1_2_Tssyk3 <- filter(df, ssyk1_code == 0)

## Group and create var.
df_22_omrade_ssyk1_2_Tssyk3 <- df_22_omrade_ssyk1_2_Tssyk3 %>%
  group_by(occupation_field.label, ssyk4, occupation_group.label) %>%
  summarize(Totalt = sum(number_of_vacancies, na.rm = TRUE),
            "Varav behovs." = sum(number_of_vacancies[employment_type.label == "Behovsanställning"], na.rm = TRUE),
            "Varav ferie" = sum(number_of_vacancies[employment_type.label == "Sommarjobb / feriejobb"], na.rm = TRUE)) %>%
  ungroup()

## Rename col. for table
df_22_omrade_ssyk1_2_Tssyk3 <- df_22_omrade_ssyk1_2_Tssyk3 %>%
  rename("Område (Af)" = occupation_field.label) %>%
  rename("SSYK4 - kod" = ssyk4) %>%
  rename("SSYK4 - text" = occupation_group.label)

## Fixa ordning enl. total_vac
df_22_omrade_ssyk1_2_Tssyk3 <- arrange(df_22_omrade_ssyk1_2_Tssyk3, desc(Totalt))

ft <- flextable(df_22_omrade_ssyk1_2_Tssyk3)
ft <- set_caption(ft, caption =sprintf("Tabell 10. Antal tjänster utifrån SSYK1-0 (militära yrken), redovisat per yrkesområde (Af) och SSYK4-nivå - %s", geografi), align_with_table = F)
#ft <- add_header_row(ft, colwidths = c(1,2,4,3), values = c("","Arbetskraften","Ej i arbetskraften","Nyckeltal"))
ft <- colformat_num(x = ft,
                    big.mark=" ", decimal.mark = ",",
                    na_str = "N/A")
ft <- theme_vanilla(ft)
#ft <- align(ft, i = 1, j=NULL, align = "center", part = "header")
ft
```
Källa: Af och bearbetningar av Region Västernorrland


<br>
<br>

Rapport genererad genom R med R Markdown.

Kontakt: ilkka.kemppainen@regionjh.se

<br>

```{r, out.width = "20%", fig.align = "center", echo=FALSE}
knitr::include_graphics("analysportal_top.jpg")
#20%
```